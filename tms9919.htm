<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <meta name="GENERATOR" content="Mozilla/4.79 [en] (WinNT; U) [Netscape]">
</head>
<body>

<center>
<h1>
<a href="http://www.nouspikel.com/ti99/titechpages.htm"><img SRC="logo.jpg" ALT="" style="border: 0px solid ; height: 33px; width: 95px;" title="Back to main index" ></a></h1></center>

<h1>
TMS9919 Sound chip</h1>
<a href="#Pinout">Pinout</a>
<br><a href="#Structure">Internal structure</a>
<br><a href="#Timing%20diagrams">Timing diagram</a>
<br><a href="#Electrical">Electrical characteristics</a>
<p><a href="#Programming">Programming the sound generators</a>
<br><a href="#Notes">Playing notes</a>
<br><a href="#Direct">Direct sound</a>
<h2>
Introduction</h2>
The TMS9919 sound chip contains three independent tone generators and a
noise generator that can emit either white noise (i.e. all frequency have
identical energy) or periodic noise. I don't have the data manual for this
chip, but I have one for the SN76489 and SN76496, very similar chips manufactured
by TI. The only difference I noted was that the AUDIOIN pin is not connected
on the SN76489AN. If anybody happens to have a copy of the actual TMS9919
manual please <a href="feedback.htm#Info">let me know.</a>
<h2>
<a NAME="Pinout"></a>Pinout</h2>

<pre>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +----+--+----+&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; D2 |1 o&nbsp; T&nbsp;&nbsp;&nbsp; 16| Vcc&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; D1 |2&nbsp;&nbsp;&nbsp; M&nbsp;&nbsp;&nbsp; 15| D3&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; D0 |3&nbsp;&nbsp;&nbsp; S&nbsp;&nbsp;&nbsp; 14| CLK&nbsp;
&nbsp;&nbsp; READY |4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 13| D4&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp; WE* |5&nbsp;&nbsp;&nbsp; 9&nbsp;&nbsp;&nbsp; 12| D5&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp; CS* |6&nbsp;&nbsp;&nbsp; 9&nbsp;&nbsp;&nbsp; 11| D6&nbsp;
AUDIOOUT |7&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp; 10| D7&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp; Vss |8&nbsp;&nbsp;&nbsp; 9&nbsp;&nbsp;&nbsp;&nbsp; 9| AUDIOIN&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +------------+</pre>
<u>Power supply</u>
<br><b>Vcc </b>+5V, (via a 6.8 uH inductor in the TI-99/4A)
<br><b>Vss </b>Ground
<br>&nbsp;
<p><u>CPU interface</u>
<br><b>D0-D7</b> These input pins accept commands from the CPU.
<p><b>CS*</b> Chip select. When this pin is active (low) the TMS9919 will
input data from the data bus. For proper operation, the device should be
initialized by pulling both CS* and WE* high.
<p><b>WE*</b> Write enable. When active (low) this pin signals a write
operation. As far as I know, all operations dealing with the TMS9919 are
write operations. I'm not aware that there is anything to read. <a href="feedback.htm#questions">Anyone</a>?
<p><b>READY</b> This pin goes low to put the CPU on hold until the TMS9919
is ready: it takes approximately 32 CLOCK cycles for the chip to load data
into a register.
<br>&nbsp;
<table BORDER >
<caption><tbody>
<br></tbody></caption>

<tr>
<th>CS*</th>

<th>WE*</th>

<th>READY</th>
</tr>

<tr>
<td>L</td>

<td>L</td>

<td>L</td>
</tr>

<tr>
<td>L</td>

<td>H</td>

<td>L</td>
</tr>

<tr>
<td>H</td>

<td>L</td>

<td>H</td>
</tr>

<tr>
<td>H</td>

<td>H</td>

<td>H</td>
</tr>
</table>

<p><u>Sound pins</u>
<br><b>CLK </b>Clock pin. Receives the basic clock signal used to generate
sounds. The acceptable frequency ranges from 0 to 4MHz. On the TI-99/4A,
this pin can receive either a 3.58 MHz signal from the VDP CPUCLK pin (pin
38), or a 447.4 kHz generated by the VDP GROMCLK pin (pin 37). The actual
signal is selected via a jumper in the console. This was probably done
so you could have either a SN76494N or a SN76489 as your sound chip. The
SN76494N would use the 447.4 kHz and divide it by 2 internally, whereas
the SN76489 would use the 3.58 MHz signal and divide it by 16 internally.
The end result is the same in both cases: an internal clock signal of 223.7
kHz.
<p><b>AUDIOIN </b>This input pin receives preformed sound signals and transmits
them to the AUDIOOUT pin. It is an analog input. In the TI-99/4A is is
connected to pin #44 of the side port via a 330 Ohm resistor, for sound
input from the speech synthesizer. It is also connected in parallel to
the cassette input port which allow us to ear that funny noise when reading
a program from tape. Finally, the TMS9901 also controls this line via a
transistor, which could be used by application programs to directly generate
sounds via the CRU. This pin is marked n.c. on the SN76489.
<p><b>AUDIOOUT </b>This pin carries the sound data to the monitor's speaker
(pin 3 of the connector). It is connected to an internal analog audio amplifier.
<br>&nbsp;
<table CELLSPACING=2 CELLPADDING=2 BGCOLOR="#CCCCE6" >
<caption><tbody>
<br></tbody></caption>

<tr>
<td>
<pre>--+
&nbsp;#7|--------+----||---+--uuu---+----&lt; pin 3 monitor port
&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp; 100uF&nbsp; | ?uH&nbsp;&nbsp;&nbsp; |&nbsp;
&nbsp;&nbsp; |&nbsp; 0.1uF =&nbsp;&nbsp;&nbsp; 10nF =&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = 10nF&nbsp;
&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;
&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +--www---Gnd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Gnd&nbsp;
--+ 10 Ohm&nbsp;</pre>
</td>
</tr>
</table>

<h2>
<br>
<a NAME="Structure"></a>Internal structure</h2>
The signal received from the CLOCK pin is divided by 16 to provide the
internal signal frequency. This means that the CLOCK signal can be as high
as 4 MHz and yet produce audible sounds. Note that there exists a chip,
SN76494N, that is exactly similar to the SN76489 except that the CLOCK
signal is only divided by 2. It allows to use a clock signal in the 500
kHz range.
<p>The chip contains three tone generators and a noise generator. Each
tone generator consists in: a programmable frequency divider that divides
the CLOCK frequency by a user-definable value to generate the appropriate
tone, a fixed 1/2 frequency divider and a programmable attenuator that
allows to control the volume in increments of 2 dB.
<p>The noise generator comprises: a fixed 1/16 divider, a programmable
divider (1/2, 1/4 or 1/8), a noise source and an attenuator identical to
that of the tone generators. The programmable divider can also accept the
output of tone generator number 3 as an input. The noise source is a shift
register with a XOR feed-back to prevent lockup in zero state. It is possible
to control this feedback circuit to toggle between a "white" noise and
a periodic noise. The shift register is cleared each time the divider is
loaded, then it shifts at the frequency determined by the divider output.
<p>The four signals are combined by an analog summer, whose output drives
an audio amplifier, typically with a current from 0 to -160 uA. The audio
output can generate upto 10 mA.
<br>&nbsp;
<table CELLSPACING=2 CELLPADDING=2 BGCOLOR="#CCCCE6" >
<caption><tbody>
<br></tbody></caption>

<tr>
<td>
<pre>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ______&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _____&nbsp;&nbsp;&nbsp;&nbsp; __________
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ,--|<u> 1/N&nbsp; </u>|----|<u> 1/2 </u>|---|<u>Attenuator</u>|---,&nbsp;&nbsp; +1.5V
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ______&nbsp;&nbsp; |&nbsp;&nbsp; ______&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _____&nbsp;&nbsp;&nbsp;&nbsp; __________&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp; |\
CLOCK >--|<u> 1/16 </u>|--+--|<u> 1/N&nbsp; </u>|----|<u> 1/2 </u>|---|<u>Attenuator</u>|-, '-|\&nbsp; '--|+\
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp; ______&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _____&nbsp;&nbsp;&nbsp;&nbsp; __________&nbsp; '---| \&nbsp;&nbsp;&nbsp; |&nbsp; \_ _ AUDIOOUT
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ,-----------+--|<u> 1/N&nbsp; </u>|----|<u> 1/2 </u>|-+-|<u>Attenuator</u>|-----|&nbsp; \_ _|&nbsp; / |
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ,---------------'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp; / | |-/&nbsp; |
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp; ______&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<u>&nbsp;&nbsp; |&nbsp;&nbsp;</u>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _____&nbsp;&nbsp;&nbsp;&nbsp; __________&nbsp;&nbsp; ,--| /&nbsp; | |/&nbsp;&nbsp; |&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; '--|<u> 1/16 </u>|----|<u> 1/n&nbsp; </u>|----|<u>shift</u>|---|<u>Attenuator</u>|--'&nbsp; |/&nbsp;&nbsp; '--WWW-'
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Summer&nbsp;&nbsp;&nbsp; 17K&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</pre>
</td>
</tr>
</table>

<p>The four attenuators and the four programmable dividers can be accessed
from the data bus, as 8 dedicated registers. The tone dividers are 10-bit
wide and thus require two bytes of data.
<h4>
Tone frequency dividers</h4>

<table BORDER >
<caption><tbody>
<br></tbody></caption>

<tr>
<td>1&nbsp;</td>

<td>R0</td>

<td>R1</td>

<td>R2</td>

<td>F6</td>

<td>F7</td>

<td>F8</td>

<td>F9</td>

<td></td>

<td>0&nbsp;</td>

<td>x&nbsp;</td>

<td>F0</td>

<td>F1</td>

<td>F2</td>

<td>F3</td>

<td>F4</td>

<td>F5</td>
</tr>
</table>

<p>R0-R2: Register address (see below)
<br>F0-F9: Number by which to divide the frequency (>01-3F)
<p>NB The register address is latched on-chip when the first byte is passed.
This means that the second byte can be sent repeatedly, as it is identified
by a 0 in the most significant bit. In this way, you can very rapidly sweep
frequencies, by changing only the 6 most significant bits (F0-F5) with
a single byte transfer.
<h4>
<br>
Noise frequency divider</h4>

<table BORDER >
<caption><tbody>
<br></tbody></caption>

<tr>
<td>1&nbsp;</td>

<td>R0</td>

<td>R1</td>

<td>R2</td>

<td>x&nbsp;</td>

<td>FB</td>

<td>F0</td>

<td>F1</td>
</tr>
</table>

<p>R0-R2: Register address (see below)
<br>FB: Feed-back option 0 = periodic, 1 = white noise
<br>F0-F1: Number by which to divide the frequency: 00 = 512, 01 = 1024,
10 = 2048, 11 = use generator #3
<h4>
<br>
Attenuators</h4>

<table BORDER >
<caption><tbody>
<br></tbody></caption>

<tr>
<td>1&nbsp;</td>

<td>R0</td>

<td>R1</td>

<td>R2</td>

<td>A0</td>

<td>A1</td>

<td>A2</td>

<td>A3</td>
</tr>
</table>

<p>R0-R2: Register address (see below)
<br>A0-A3: Attenuation. A0 = 16 dB, A1 = 8 dB, A2 = 4dB, A3 = 2 dB. 1111
= sound off
<br>The attenuation accuracy is quite poor: +/- 1 dB
<h4>
<br>
Register address</h4>

<table BORDER >
<caption><tbody>
<br></tbody></caption>

<tr>
<th>R0</th>

<th>R1</th>

<th>R2</th>

<th>Register&nbsp;</th>
</tr>

<tr>
<td>0</td>

<td>0</td>

<td>0</td>

<td>Tone 1 frequency divider&nbsp;</td>
</tr>

<tr>
<td>0</td>

<td>0</td>

<td>1</td>

<td>Tone 1 attenuator</td>
</tr>

<tr>
<td>0</td>

<td>1</td>

<td>0</td>

<td>Tone 2 frequency divider&nbsp;</td>
</tr>

<tr>
<td>0</td>

<td>1</td>

<td>1</td>

<td>Tone 2 attenuator</td>
</tr>

<tr>
<td>1</td>

<td>0</td>

<td>0</td>

<td>Tone 3 frequency divider&nbsp;</td>
</tr>

<tr>
<td>1</td>

<td>0</td>

<td>1</td>

<td>Tone 3 attenuator</td>
</tr>

<tr>
<td>1</td>

<td>1</td>

<td>0</td>

<td>Noise frequency divider&nbsp;</td>
</tr>

<tr>
<td>1</td>

<td>1</td>

<td>1</td>

<td>Noise attenuator</td>
</tr>
</table>

<h2>
<br>
<a NAME="Timing diagrams"></a>Timing diagram</h2>

<pre>______&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _________&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _______&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \_____________/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \_____________/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CE*
_____<u>|</u>_<u>a</u>_| 90-150 ns&nbsp;&nbsp;<u>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</u>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<u>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</u>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp; \<u>___</u>________/&nbsp; >0&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp; |a \<u>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </u>/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; READY
<u>&nbsp;&nbsp;&nbsp;&nbsp; | >0&nbsp;&nbsp; </u>|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<u>&nbsp;&nbsp;&nbsp; |&nbsp; </u>|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<u>&nbsp;&nbsp;&nbsp;&nbsp;</u>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \_____________/&nbsp;&nbsp;&nbsp; |&nbsp; \_______<u>&nbsp;&nbsp;&nbsp;&nbsp; </u>/&nbsp;&nbsp;&nbsp;&nbsp; WE*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<u>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</u> <u>|>0|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</u> <u>|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</u>&nbsp;<u>&nbsp;&nbsp;</u>&nbsp;
<u>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </u>X<u>&nbsp;&nbsp;&nbsp;&nbsp; first byte&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </u>X<u>&nbsp;&nbsp; second byte&nbsp;&nbsp;&nbsp; </u>X<u>&nbsp;&nbsp;</u> D0-D7</pre>

<pre>a) 90-150 ns</pre>

<h2>
<br>
<a NAME="Electrical"></a>Electrical characteristics</h2>

<h3>
Absolute maximum ratings</h3>

<pre>Supply voltage: Vcc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 7V
Input voltage:&nbsp; AUDIOIN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.9V
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; All others&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 7V
Output current on AUDIOOUT&nbsp;&nbsp;&nbsp;&nbsp; 10 mA
Continuous power dissipation 1150 mW&nbsp;
Free air temperature:&nbsp;&nbsp;&nbsp;&nbsp; 0 to 70 `C
Storage temperature:&nbsp;&nbsp; -55 to 150 `C</pre>

<h3>
<br>
<br>
Recommended operating conditions</h3>

<table BORDER >
<caption><tbody>
<br></tbody></caption>

<tr>
<th>Parameter</th>

<th>Min</th>

<th>Nom</th>

<th>Max</th>

<th>Unit</th>
</tr>

<tr>
<td>Supply voltage, Vcc</td>

<td>4.5</td>

<td>5</td>

<td>5.5</td>

<td>V</td>
</tr>

<tr>
<td>High-level input voltage</td>

<td>2</td>

<td>.</td>

<td>.</td>

<td>V</td>
</tr>

<tr>
<td>Low-level input voltage&nbsp;</td>

<td>.</td>

<td>.</td>

<td>0.8</td>

<td>V</td>
</tr>

<tr>
<td>AUDIOIN input current</td>

<td>0</td>

<td>.</td>

<td>1.8</td>

<td>mA</td>
</tr>

<tr>
<td>High-level output voltage (READY)&nbsp;</td>

<td>.</td>

<td>.</td>

<td>5.5</td>

<td>V</td>
</tr>

<tr>
<td>Low-level output current (READY)</td>

<td>.</td>

<td>.</td>

<td>2</td>

<td>mA</td>
</tr>

<tr>
<td>Input clock frequency</td>

<td>.</td>

<td>.</td>

<td>4</td>

<td>MHz</td>
</tr>

<tr>
<td>Free-air temperature</td>

<td>0</td>

<td>.</td>

<td>70</td>

<td>`C</td>
</tr>
</table>

<h3>
<br>
Electrical characteristics under recommended conditions</h3>

<table BORDER >
<caption><tbody>
<br></tbody></caption>

<tr>
<th>Parameter</th>

<th>Test conditions</th>

<th>Min</th>

<th>Typ</th>

<th>Max</th>

<th>Unit</th>
</tr>

<tr>
<td>High-level output current (READY)&nbsp;</td>

<td>Vo = +5.5V</td>

<td>.</td>

<td>.</td>

<td>10</td>

<td>uA</td>
</tr>

<tr>
<td>High-level input current (all digital pins)</td>

<td>Vi = Vcc</td>

<td>.</td>

<td>.</td>

<td>10</td>

<td>uA</td>
</tr>

<tr>
<td>Low-level input current CE* pin
<br>D0-D7, WE*, CLK pins</td>

<td>Vi = 0</td>

<td>.</td>

<td>-25
<br>-10</td>

<td>-175
<br>-70</td>

<td>uA</td>
</tr>

<tr>
<td>Input bias voltage (AUDIOIN)</td>

<td>R = 4.7 KOhm to Vcc</td>

<td>0.5</td>

<td>0.7</td>

<td>0.9</td>

<td>V</td>
</tr>

<tr>
<td>High-level output voltage (AUDIOOUT)&nbsp;</td>

<td>.</td>

<td>.</td>

<td>.</td>

<td>5.5</td>

<td>V</td>
</tr>

<tr>
<td>Low-level output voltage (READY)&nbsp;</td>

<td>I = 2 mA</td>

<td>.</td>

<td>0.25</td>

<td>0.4</td>

<td>V</td>
</tr>

<tr>
<td>Peak-to-peak output voltage (AUDIOOUT)&nbsp;</td>

<td>Vcc = +5V Attenuation = 0 dB
<br>(other generators -30 dB)&nbsp;</td>

<td>260</td>

<td>.</td>

<td>.</td>

<td>mV</td>
</tr>

<tr>
<td>Supply current</td>

<td>Outputs open</td>

<td>.</td>

<td>30</td>

<td>50</td>

<td>mA</td>
</tr>

<tr>
<td>Input capacitance</td>

<td>.</td>

<td>.</td>

<td>.</td>

<td>15</td>

<td>pF</td>
</tr>
</table>

<pre>&nbsp;</pre>

<h2>
<br>
<a NAME="Programming"></a>Programming the sound generators</h2>
The four generators (3 tone and 1 noise) can be accessed independently
by the data bus. The first byte of data contains the address of the desired
generator and the parameter to change (frequency or volume). In some cases,
a second byte of data may follow, that will be sent to the same generator
as the previous one. In the TI-99/4A the sound chip data port is mapped
at >8400, but the address is incompletely decoded: only A0-A5, A15 and
MEMEN* are taken into account. Thus, the chip will respond to any even
address in the range >8400->85FE.
<br>&nbsp;
<table BORDER >
<caption><tbody>
<br></tbody></caption>

<tr>
<th>Generator</th>

<th>Frequency</th>

<th>Volume</th>
</tr>

<tr>
<td>Tone 1</td>

<td>>8z >xy</td>

<td>>9v</td>
</tr>

<tr>
<td>Tone 2</td>

<td>>Az >yx</td>

<td>>Bv</td>
</tr>

<tr>
<td>Tone 2</td>

<td>>Cz >yx</td>

<td>>Dv</td>
</tr>

<tr>
<td>Noise</td>

<td>>En</td>

<td>>Fv</td>
</tr>
</table>

<pre>Frequency = <u>111860.8</u> Hz&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Volume v:&nbsp; +1 = -2 dB (>F = off)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xyz</pre>

<h4>
Tones</h4>
Two bytes are required to set the frequency of a tone generator. The first
nibble of the first byte contains the address of the generator (>8, >A
or >C). The second nibble should be appended to the end of the second byte
to generate a 3-nibble number xyz. The output frequency can be calculated
by dividing 111,860.8Hz by xyz. The value 111,860.8 is due to the fact
that the 3.58 MHz clock signal is divided by 32 to produce the base frequency
used by the generators.
<p>Once the first byte is passed, the second byte can be modified as often
as needed, as long as no other command is passed. This allows for rapid
frequency changes, as only one byte needs to be passed (although only the
6 most-significant bits will be changed).
<h4>
Noises</h4>
For the noise generator, only one byte is needed. The first nibble should
contain the address (>E) and the second 3 command bits that decide whether
the generator will emit white noise or periodic noise (bit 6) and select
the basal frequency from a list of three. It is also possible to instruct
the noise generator to adopt the same frequency as tone generator 3, even
if the latter is currently silent (i.e. volume = >F).
<pre><u>1 1 1 0</u> 0 w r r&nbsp;
&nbsp; >E&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | | |
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | 0 0 : 6991 Hz&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | 0 1 : 3496 Hz&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | 1 0 : 1748 Hz&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | 1 1 : freq of generator 3&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 : Periodic noise&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 : White noise</pre>

<h4>
Volume</h4>
Strictly speaking, one does not set the volume for a generator, but rather
its attenuation. That is, higher values result in lower volumes. Zero is
the maximum volume, any increment by one reduces the volume by 2 dB (i.e.
100 times less sound energy), and >F turns the generator completely off.
<h3>
<br>
<a NAME="Notes"></a>Playing notes</h3>
Here is a table that you can use to program the frequencies of a "well-tempered
keyboard". Just replace the dot with the code of the desired generator
(>8, >A or >C) and pass the result as two bytes at >8400.
<br>&nbsp;
<table BORDER >
<caption><tbody>
<br></tbody></caption>

<tr>
<td>
<pre>C&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</pre>
</td>

<td>-</td>

<td>.735</td>

<td>.C1A</td>

<td>.60D</td>

<td>.B06</td>

<td>.503</td>

<td>.B01</td>
</tr>

<tr>
<td ALIGN=RIGHT>############</td>

<td>-</td>

<td>.732</td>

<td>.419</td>

<td>.A0C</td>

<td>.506</td>

<td>.203</td>

<td>.901</td>
</tr>

<tr>
<td>
<pre>D</pre>
</td>

<td>-</td>

<td>.A2F</td>

<td>.D17</td>

<td>.E0B</td>

<td>.F05</td>

<td>.003</td>

<td>.801</td>
</tr>

<tr>
<td ALIGN=RIGHT>############</td>

<td>-</td>

<td>.F2C</td>

<td>.816</td>

<td>.40B</td>

<td>.A05</td>

<td>.D02&nbsp;</td>

<td>.601</td>
</tr>

<tr>
<td>
<pre>E</pre>
</td>

<td>-</td>

<td>.72A</td>

<td>.315</td>

<td>.A0A</td>

<td>.505</td>

<td>.A02</td>

<td>.501</td>
</tr>

<tr>
<td>
<pre>F</pre>
</td>

<td>-</td>

<td>.128</td>

<td>.014</td>

<td>.00A</td>

<td>.005</td>

<td>.802</td>

<td>.401</td>
</tr>

<tr>
<td ALIGN=RIGHT>############</td>

<td>-</td>

<td>.D25</td>

<td>.E12</td>

<td>.709</td>

<td>.C04</td>

<td>.602</td>

<td>-</td>
</tr>

<tr>
<td>
<pre>G</pre>
</td>

<td>-</td>

<td>.B23</td>

<td>.D11</td>

<td>.F08</td>

<td>.704</td>

<td>.402</td>

<td>-</td>
</tr>

<tr>
<td ALIGN=RIGHT>############</td>

<td>-</td>

<td>.B21</td>

<td>.D10</td>

<td>.708</td>

<td>.304</td>

<td>.202</td>

<td>-</td>
</tr>

<tr>
<td>
<pre>A</pre>
</td>

<td>.93F</td>

<td>.C1F</td>

<td><u>.E0F</u></td>

<td>.F07</td>

<td>.004</td>

<td>.002</td>

<td>-</td>
</tr>

<tr>
<td ALIGN=RIGHT>############</td>

<td>.03C</td>

<td>.01E</td>

<td>.00F</td>

<td>.807</td>

<td>.C03</td>

<td>.E01</td>

<td>-</td>
</tr>

<tr>
<td>
<pre>B</pre>
</td>

<td>.A38</td>

<td>.51C</td>

<td>.20E</td>

<td>.107</td>

<td>.903</td>

<td>.C01</td>

<td>-</td>
</tr>
</table>

<p><u>Notes</u>
<br>The underlined .E0F corresponds to the middle A at 440 Hz. Note that
many orchestra nowadays tend to tune their middle A at a higher pitch:
at 441, 442 or even upto 444 Hz. I'll leave you with the task to correct
this table accordingly..
<p>You may have noted that the calculated frequency follows a log scale,
dobbling from one column to another (taking rounding mistakes into account).
That's because of the way our ear is designed: octaves, subjectively "equal"
intervals of 12 half-tones correspond to a dobbling of the frequency. This
allow us to ear a wide range of frequencies.
<p>One last remark: this table works well to emulate keyboard instruments
(piano, harpsichord, organ) that are "tempered", i.e. on which an A sharp
is the same as a B flat. This is not the case for other instruments like
the violin or the cello: on these the A sharp is a tad (a "coma" in french,
a "microtone" in english?) higher than the B flat. Most people won't notice
the difference, unless the same note is played on a piano and a violin
together: it gives the impression that the violinist does not play in tune.
He does! It's the piano that's wrong.
<h4>
<br>
Examples</h4>

<table CELLSPACING=2 CELLPADDING=2 BGCOLOR="#E6E6E6" >
<caption><tbody>
<br></tbody></caption>

<tr>
<td>
<pre>* Let's play a note&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LI&nbsp;&nbsp; R0,>8400&nbsp;&nbsp;&nbsp;&nbsp; Sound port address on the TI-99/4A&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LI&nbsp;&nbsp; R1,>8E0F&nbsp;&nbsp;&nbsp;&nbsp; Middle A on generator 1&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MOVB R1,*R0&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SWPB R1&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MOVB R1,*R0&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LI&nbsp;&nbsp; R2,>9200&nbsp;&nbsp;&nbsp;&nbsp; Volume: 4 dB below maximum&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MOVB R2,*R0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Play it
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Wait
&nbsp;
* Now let's make a noise (the note is still playing)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LI&nbsp;&nbsp; R1,>DF00&nbsp;&nbsp;&nbsp;&nbsp; Make sure generator 3 is off&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MOVB R1,*R0&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LI&nbsp;&nbsp; R1,>CC1A&nbsp;&nbsp;&nbsp;&nbsp; C on generator 3&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MOVB R1,*R0&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SWPB R1&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MOVB R1,*R0&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LI&nbsp;&nbsp; R1,>E300&nbsp;&nbsp;&nbsp;&nbsp; Periodic noise, picking frequency from gen 3&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MOVB R1,*R0&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LI&nbsp;&nbsp; R1,>F000&nbsp;&nbsp;&nbsp;&nbsp; Volume: full blast
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Wait&nbsp;

* Turn all sounds off&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LI&nbsp;&nbsp; R1,>9F00&nbsp;&nbsp;&nbsp;&nbsp; Start with generator 1&nbsp;
LP1&nbsp;&nbsp;&nbsp; MOVB R1,*R0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Turn it off&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AI&nbsp;&nbsp; R1,>2000&nbsp;&nbsp;&nbsp;&nbsp; Next generator&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JNC&nbsp; LP1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Carry set when >EF becomes >00
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; B&nbsp;&nbsp;&nbsp; *R11</pre>
</td>
</tr>
</table>

<p>This example is deceptively simple: programming music is a fairly complicated
task. First you must decide how to encode your music: do you want a separate
list for each generator or a common list?
<p>Then you must time each note. A good way is to place a sound list in
the VDP memory and to let the <a href="ints.htm#sounds">ISR play it</a>,
but according to your needs you may want to do it yourself, for instance
with the TMS9901 timer. You must also remember that each note should be
followed by a small silence, unless you're playing <i>legato </i>(although
to repeat a note in <i>legato</i>, you still need a small silence). Conversely,
to play <i>staccato </i>or <i>pizzicatti </i>you must reduce the duration
of a note and increase the silence accordingly.
<p>And then, there is the problem of the volume: progressive changes in
volume (<i>crescendo</i>, <i>decrescendo</i>) can be tricky to program
as they must be integrated into your sound list. Finally for some instruments
to sound natural, the sound of each note should be slowly fading over time.
That's the case with the piano for instance (but not with the flute: as
long as the musician is blowing steadily, the volume remains unchanged).
<h2>
<br>
<br>
<a NAME="Direct"></a>Direct sound</h2>
We can send sound directly to the speaker via the sound chip, without using
the generators. This is achieved with CRU bit 24 in the console: it is
normally used to control whether the input from a cassette tape recorder
will be audible, but thanks to a pull-up resistor it can also be used to
generate sound even if no recorder is installed.
<br>&nbsp;
<table CELLSPACING=2 CELLPADDING=2 BGCOLOR="#E6E6E6" >
<caption><tbody>
<br></tbody></caption>

<tr>
<td>
<pre>* Tentative routine to program direct sound via the CRU
* R1 contains a pointer to a list of sound bits
* R2 is the size of the list, in words
* R3 is the delay between two bits (i.e. depends on the sampling rate)
* In addition, the routine makes use of R4, R10 and R12.&nbsp;
BITSND MOV&nbsp; R11,R10
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CLR&nbsp; R12&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CRU base of the TMS9901&nbsp;
LP2&nbsp;&nbsp;&nbsp; MOV&nbsp; *R1+,R4&nbsp;&nbsp;&nbsp;&nbsp; Get one word from the list&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LI&nbsp;&nbsp; R0,16&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 16 bits per word&nbsp;
LP1&nbsp;&nbsp;&nbsp; SLA&nbsp; R4,1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Test next bit&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JNC&nbsp; SK1&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SBO&nbsp; 24&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Send 1 to sound gate&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JMP&nbsp; SK2&nbsp;
SK1&nbsp;&nbsp;&nbsp; SBZ&nbsp; 24&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Send 0 to sound gate&nbsp;
SK2&nbsp;&nbsp;&nbsp; BL&nbsp;&nbsp; @DELAY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Delay between two bits
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DEC&nbsp; R0&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JNE&nbsp; LP1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Next bit
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DEC&nbsp; R2&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JNE&nbsp; LP2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Next word
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; B&nbsp;&nbsp;&nbsp; *R10
&nbsp;
* Delay routine
DELAY MOV&nbsp; R3,R12&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Get delay value (in R12, to save a register)
LP3&nbsp;&nbsp; DEC&nbsp; R12
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JNE&nbsp; LP3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Keep waiting
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; B&nbsp;&nbsp;&nbsp; *R11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; R12 is now >0000, which is the correct CRU value</pre>

<pre>* NB: for short delays, we should account for the longer time between two
* words, due to the 4 extra instructions needed to load a new word.</pre>

<pre>* Main program
START LI&nbsp;&nbsp; R1,BUFFER&nbsp;&nbsp; Buffer address
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LI&nbsp;&nbsp; R2,>0800&nbsp;&nbsp;&nbsp; Buffer size
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LI&nbsp;&nbsp; R3,>AAAA&nbsp;&nbsp;&nbsp; Test pattern: highest possible pitch (1010 1010)
L0&nbsp;&nbsp;&nbsp; MOV&nbsp; R3,*R1+&nbsp;&nbsp;&nbsp;&nbsp; Fill buffer with test pattern
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DEC&nbsp; R2
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JNE&nbsp; L0</pre>

<pre>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LI&nbsp;&nbsp; R1,BUFFER&nbsp;&nbsp; Buffer address
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LI&nbsp;&nbsp; R2,>0800&nbsp;&nbsp;&nbsp; Buffer size
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LI&nbsp;&nbsp; R3,>0040&nbsp;&nbsp;&nbsp; Delay value
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BL&nbsp;&nbsp; @BITSND&nbsp;&nbsp;&nbsp;&nbsp; Play buffer content
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return when done (this may take time)</pre>
</td>
</tr>
</table>

<p>Here, the tricky part is to determine the list of bits to be passed.
I wonder if PC .RAW files could be used?
<p>Also, I don't think there is any way to control the volume. Any <a href="feedback.htm#Info">suggestions</a>?
<h4>
<br>
SoundFX</h4>
A different method was used by Barry Boone in his excellent SoundFX program.
He sets the maximum frequency (>001) on the three sound generators and
then modulates the volume (identically for all three). Obviously, this
implies carefully controlled timing loops so as to generate the required
frequency.
<p>Barry made the SoundFX source available on his website, so I encourage
you to have a look at it. <a href="soundfx.txt">Here</a> is an excerpt,
containing only the sound generation routines and the routines that translate
other sound files in SoundFX format.
<br>&nbsp;
<address>
Revision 1. 2/19/99. OK for release</address>

<address>
Revision 2. 3/30/99. Polishing</address>

<address>
Revision 3. 5/30/99. Tested &amp; debugged examples</address>

<address>
Revision 4. 6/16/00. Added SoundFX info</address>

<address>
Revision 5. 7/2/00. Got the SN76489 manual. Added structure, timing, electricals.</address>

<address>
Revision 6. 7/12/00. Got the SN76494 manual. Changes electricals.</address>

<address>
Revision 7. 1/4/10. Swapped pin D3 and CLK. Added note of different clock
signals from VDP.</address>

<br>&nbsp;
<p>&nbsp;
<br>&nbsp;
<br>
<center>
<p><a href="titechpages.htm">Back to the TI-99/4A Tech Pages</a></center>

</body>
</html>
