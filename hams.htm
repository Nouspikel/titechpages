<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <meta name="Author" content="asdf">
   <meta name="GENERATOR" content="Mozilla/4.79 [en] (WinNT; U) [Netscape]">
   <title>The HAMS board</title>
</head>
<body>

<center>
<h1>
<a href="http://www.nouspikel.com/ti99/titechpages.htm"><img SRC="logo.jpg" style="border: 0px solid ; height: 33px; width: 95px;" title="" height=33 width=95></a></h1></center>

<h1>
The HAMS board</h1>
This is my variation on the design of the SuperAMS board. It uses the same
mapper chip, but allows for more memory and more complete mapping. Its
main features are:
<ul>
<li>
Upto 16 megabytes of memory</li>

<li>
Accepts SRAM and EEPROM chips</li>

<li>
Maps memory at >4000-5FFF: Can have DSRs</li>

<li>
Maps at >6000-7FFF (cartridge space)</li>

<li>
Maps at >0000-1FFF: can override console ROMs</li>

<li>
Maps at >8000-8300: can override console RAM</li>
</ul>
<b>Hardware description</b>
<br><a href="#hardware">_Bus buffering</a>
<br><a href="#CRU logic">_CRU interface</a>
<br><a href="#mapping control">_Mapping control</a>
<br><a href="#memory mapper">_The memory mapper</a>
<br><a href="#dip switch">_DIP-switch settings</a>
<br><b>Building the board</b>
<br><a href="#Building it">_List of components</a>
<br><a href="#Installing memory">_Installing memory chips</a>
<br><a href="#wiring summary">_Summary of memory wiring</a>
<br><a href="#console mod">_Console modification</a>
<br><b>Software issues</b>
<br><a href="#switching pages">_Switching pages</a>
<br><a href="#page numbering">_Page numbering scheme</a>
<br><a href="#programming EEPROMs">_Programming an EEPROM</a>
<br><a href="#transparent mode">_Transparent mode</a>
<br><a href="#CRU map">_CRU map</a>
<h4>
<font color="#FF0000">Disclaimer. Read this first.</font></h4>
<i>I actually have not built that board yet. Before I left the USA, I laid
out a PCB, had it manufactured, and bought all the necessary chips. But
then I moved to the UK, started my own lab, had a baby girl... and never
managed to populate the board. As a matter of fact, I don't even have a
TI-99/4A system to test it with. So, if you want to build the HAMS board,
you are wellcome to, but I cannot guarantee that it will work. For all
I know, it may fry your console or your PE-box, it may even explode and
take your house with it!</i>
<p>Ok, you have been warned. If you're foolish enough to persist in building
it, you may download <a href="hmem82.zip">this zip file</a> with contains
the "Gerber" files of the PCB and a summary of chip connections.
<br>&nbsp;
<h2>
<a NAME="hardware"></a>Hardware description</h2>

<h4>
Bus buffering</h4>
As recommended by Texas Instruments, all lines to/from the peripheral bus
are buffered on-card. However, given that the buffers have to drive an
awful number of chips, I recommend using bi-CMOS-TTL chips, like the 74BCT244
or 74ABT244 rather than the the classical 74LS244. For the same reason,
after DBIN is inverted with a 74LS04, it is buffered again by a 74ABT244
before being applied to the OE* pin of the memory chips.
<p>Similarly, the data bus needs a bidirectional 74ABT245 buffer. The DIRection
is controlled by the DBIN signal from the peripheral bus, the ENable pin
by the CardSel* signal generated by the card (see below).
<p>The CardSel* signal is also connected via a 74LS125 to the RDBENA* line
of the peripheral bus to enable the drivers in the connection card and
the console-end of the cable. A 74LS125 is necessary, so as not to hold
the line high when we are not using it, as another card may need it. The
CardSel* signal enables the '125 which input is connected to the ground,
the rest of the time the 74LS125 is in high-impedance (i.e. isolated) state.
<p>Two of the remaining gates of the 74LS125 serve to buffer extra signal
lines, such as CRUCLK* and RESET* (see CRU interface below). The last gate
is not used, its inputs are connected to ground, its output is not connected.
<br>&nbsp;
<table CELLSPACING=2 CELLPADDING=2 BGCOLOR="#CCCCE6" >
<caption><tbody>
<br></tbody></caption>

<tr>
<td>
<pre>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 74ABT244&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +-----+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp; A0>---|A8 Y8|---A0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp; A1>---|A1 Y1|---A1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp; A2>---|A7 Y7|---A2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp; A3>---|A2 Y2|---A3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp; A4>---|A6 Y6|---A4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp; A5>---|A3 Y3|---A5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp; A6>---|A5 Y5|---A6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp; A7>---|A4 Y4|---A7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Gnd--|G*&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +-----+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +-----+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp; A8>---|A8 Y8|---A8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp; A9>---|A1 Y1|---A9&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; A10>---|A7 Y7|---A10&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; A11>---|A2 Y2|---A11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; A12>---|A6 Y6|---A12&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; A13>---|A3 Y3|---A13&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; A14>---|A5 Y5|---A14&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; A15>---|A4 Y4|---A15&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Gnd--|G*&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +-----+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; '244&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +-----+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;MEMEN*>---|A6 Y6|---MEMEN*&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; WE*>---|A7 Y7|---WE*&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;,---------|A5 Y5|----DBIN*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;| DBIN>---|A8 Y8|-----+-|>o-,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;|&nbsp;&nbsp;&nbsp; Gnd--|G2*&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; | 04&nbsp; |
&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +-----+&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;'---------------------|-----'&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +-----+&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp; DIR|&lt;----'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; D0&lt;--->|B8 A8|&lt;--> D0&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp; .&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp; .&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp; .&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp; .&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp; .&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp; .&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; D7&lt;--->|B1 A1|&lt;--> D7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp; OE*|&lt;-------,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +-----+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +----------&lt; CardSel*&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 74ABT245&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
RDBENA*&lt;------------------&lt;|--Gnd
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; '125&nbsp;&nbsp;</pre>
</td>
</tr>

<tr>
<td></td>
</tr>
</table>

<h4>
<br>
<a NAME="CRU logic"></a>CRU logic</h4>
The CRU logic is very basic. A 74LS688 comparator, enabled by the CRUCLK*
signal, is used to compare the CRU address to the address set with a DIP
switch, and make sure it's in the format >1nxx. The output of the comparator
enables latching of the A15/CRUOUT bit by the 74LS259 addressable latch.
Lines A12-A14 are used to select a bit among eight. The RST* pin of the
74LS259 ensures that latch is reset upon power-up or console hardware reset,
i.e. that all bits will return to zero. Some of them need to be active
high be default, and are therefore inverted with 74LS04 inverters. Note
that no provision is made to read back the status of the bits.
<br>&nbsp;
<table CELLSPACING=2 CELLPADDING=2 BGCOLOR="#CCCCE6" >
<caption><tbody>
<br></tbody></caption>

<tr>
<td>
<pre>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 74LS688&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +------+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A0---|B1&nbsp; A1|--Gnd
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A1---|B7&nbsp; A7|--Gnd
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A2---|B5&nbsp; A5|--Gnd
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A3---|B3&nbsp; A3|--+5V&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4k7
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A4---|B6&nbsp; A6|----------+---WWW---+---+5V
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A5---|B2&nbsp; A2|---------+|---WWW---+&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A6---|B4&nbsp; A4|--------+||---WWW---+&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A7---|B0&nbsp; A0|-------+|||---WWW---'
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 74LS125&nbsp; |&nbsp; A=B*|---,&nbsp;&nbsp;&nbsp; ||||&nbsp;&nbsp;
CRUCLK*---|>----|G*&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp; |&nbsp;&nbsp; ||||&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; +------+&nbsp;&nbsp; |&nbsp;&nbsp; oooo&nbsp; DIP&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Gnd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp; oooo&nbsp; switch&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp; ||||&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp; ++++--Gnd&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ,----------------'
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 74LS259&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LED&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; +------+&nbsp; ,-WWW--|>|---Gnd&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; '----|G*&nbsp;&nbsp;&nbsp; |&nbsp; |
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A12----|S2&nbsp; Q0|--+--Bit0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A13----|S1&nbsp; Q1|-----Bit1&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A14----|S0&nbsp; Q2|-----Bit2
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; Q3|-----Bit3
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A15----|D&nbsp;&nbsp; Q4|-----Bit4
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 74LS125&nbsp; |&nbsp;&nbsp;&nbsp; Q5|-----Bit5
RESET*---|>----|RST*Q6|-----Bit6
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; Q7|-----Bit7&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Gnd&nbsp;&nbsp; +------+&nbsp;&nbsp;</pre>
</td>
</tr>

<tr>
<td></td>
</tr>
</table>

<h4>
<a NAME="mapping control"></a>Mapping control</h4>
This circuit determines in which memory area the board should answer, based
on CRU bits and DIP-switch settings.
<br>&nbsp;
<table CELLSPACING=2 CELLPADDING=2 BGCOLOR="#CCCCE6" >
<caption><tbody>
<br></tbody></caption>

<tr>
<td>
<pre>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +5V--+-+-+&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | | |&nbsp; 74LS151&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4k7 R R R&nbsp; +------+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Gnd----o o-------|-|-+--|D1&nbsp; S0|--A2
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | | +--|D5&nbsp; S1|--A1
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | | +--|D6&nbsp; S2|--A0&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | | '--|D7&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; 4k7&nbsp;&nbsp;
Bit2---o o-------+-|----|D0&nbsp;&nbsp;&nbsp; |&nbsp; ,--WWW--+5V
Bit5--|>o----------|----|D3&nbsp; G*|--+-o o---Memen*
&nbsp;&nbsp;&nbsp;&nbsp; 74LS04&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |
A4--,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |
A5--=)>--=)>--o o--+----|D4&nbsp; Y*|&nbsp;&nbsp;&nbsp;&nbsp;
A3---=)>-' 74LS32&nbsp;&nbsp; ,---|D2&nbsp;&nbsp; Y|-----------+----MemSel*
Bit6-'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp; +------+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |
&nbsp;&nbsp;&nbsp;&nbsp; _&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; =|)---CardSel*
A3--| ) 74LS30&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |74LS08
A4--|&nbsp; )&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; '------------------,&nbsp;&nbsp; |
A5--|&nbsp;&nbsp; )&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp; |
A6--|&nbsp;&nbsp;&nbsp; )o--,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dbin--,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp; |
A7--|&nbsp;&nbsp;&nbsp; )&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Bit7--=|)--=)>--'&nbsp;&nbsp; |
A8--|&nbsp;&nbsp; )&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 74LS08 | 74LS32 |
A9--|&nbsp; )&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 74LS138&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |
A10-|_)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | '08&nbsp; +------+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |
Bit4----|>o--=|)----|S0&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 74LS04&nbsp;&nbsp; A1---|S1 Y3*|------'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A2---|S2&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp; Y2*|---------------+----MapSel*
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A0---|G2A*&nbsp; |&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Memen*---|G2B*&nbsp; |&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Bit0---|G1&nbsp;&nbsp;&nbsp; |&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +------+&nbsp;&nbsp;</pre>
</td>
</tr>

<tr>
<td></td>
</tr>
</table>

<p>At the heart of the circuit is a 74LS151 that splits the address space
into 8 segments of >2000 bytes, thanks to the connection of its selection
inputs S0-S2 to address lines A2-A0. For each chunk of >2000 bytes, a different
input D0-D7 will be selected and applied to the output Y. A low level on
Y enables memory (see next schematics below), whereas a high level prevents
the board from answering to memory requests. Thus, mapping in the various
memory area can be controlled by applying low or high signal to the various
inputs. The G* enabling input is connected to the Memen* line, so that
the board only reacts to memory operations. A SPST switch installed at
the rear of the card and a pull-up resistor allow you to disable the board
completely. When this switch is opened, G* is held high and the board does
not answer any memory request (but still accepts CRU commands).
<p>Input D0 corresponds to the console ROMs, addresses >0000-1FFF. It is
connected to CRU bit 2, without any inversion. This means that mapping
in this area is on upon power up (which is necessary if you want to replace
the console ROMs). So that you can disable this feature, a DIP-switch is
inserted in the line. When the switch is open, a pull-up resistor ensures
that D0 will always be high. When the switch is closed, D0 is controlled
by CRU bit 2.
<p>Input D1, D5, D6 and D7 are tied together. They correspond to range
of the traditional memory expansion cards, >2000-3FFF and >A000-FFFF. These
cannot be controlled by CRU, but they can be enabled or disabled via a
DIP-switch connected to the ground. Here again, when the switch is open,
a pull-up resistor brings the inputs high and prevents the board from answering.
<p>Input D3 corresponds to cartridge ROM banks (or RAMBO banks for some
devices) at >6000-7FFF. It is controled by CRU bit 5, inverted by a 74LS04
gate. This means that mapping in this area is disabled upon power up, but
can be turned on by setting CRU bit 5 to '1'. There is thus no need for
a DIP-switch to disable mapping in this area.
<p>Input D4 corresponds to area >8000-9FFF, which contains the console
RAM (aka scratch-pad, at >8000-83FF), but also the access ports for many
memory mapped devices: VDP, sound chip, speech synthesizer, and GROMs.
Obviously, we don't want the board to answer to these addresses, but it
could be useful to replace the console scratch-pad. Thus, input D4 is connected
to a small circuit consisting of 3 cascading OR gates (74LS32), which combine
CRU bit 6 with address lines A3 to A5. This ensures that the board will
only answer when CRU bit 6 is zero, and the address is lower than >8400.
Just like the console ROMs, CRU bit 6 needs to be on be default, so a DIP-switch
and a pull-up resistor are used to disable this feature.
<p>Input D2 requires a more complicated circuit, as it corresponds to the
DSR space >4000-5FFF in which you can either access memory or the mappers
registers. The mapper will need another selection signal than that of the
74LS151, and it is provided by a 74LS138. The various inputs of the '138
are connected to A0-A2, Memen* and CRU bit 0, allowing the decoder to react
only to memory operations in the range >4000-5FFF, when CRU bit 0 is set
to '1'. The S0 input of the '138 determines which of the Y2* or Y3* output
will be selected, the former being used to select the mapper, while the
latter provides the memory selection signal. S0 get its input from two
sources, combined with an 74LS08 AND gate: CRU bit 4, inverted by a 74LS04
gate, and address lines A3 to A10, combined with an 8-input NAND gate.
As a results, when CRU bit 4 is '1', the mapper is accesses in the whole
address range >4000-5FFF. When CRU bit 4 is '0', the mapper only answers
at >5FE0-5FFF.
<p>The signal from output Y2* of the 74LS138 is applied directly to the
CS* input of the 74LS612 mapper. It is also inverted by a 74LS04 and applied
to the ME (map enable) input of the mapper. The signal from Y3* is applied
to input D2 of the 74LS151, after being masked trough a 74LS32 OR gate
with a combination of DBIN and CRU bit 7. This allows to disable memory
read operations in the range >4000-5FDF when CRU bit 7 is '1'. This is
necessary to program EEPROM chips that require an unlocking sequence, since
the annoying habit of the TI-99/4A to perform reads before writes may scramble
the unlocking sequence.
<p>The memory selection signal MemSel* is combined with the mapper selection
signal MapSel* via a 74LS08 gate, so as to produce the card selection signal
CardSel* which will activate the data bus (see <a href="#hardware">above</a>).
<br>&nbsp;
<h4>
<a NAME="memory mapper"></a>The memory mapper</h4>
The HAMS board uses the same memory mapper as the original AMS and SuperAMS,
the 74LS612. However, you may want to get the CMOS version, 74HCT612, which
may be faster. This may become an issue if you're planning to use my "zero-wait
states" console modification. Refer to my SuperAMS page for a detailed
description of the mapper.
<br>&nbsp;
<table CELLSPACING=2 CELLPADDING=2 BGCOLOR="#CCCCE6" >
<caption><tbody>
<br></tbody></caption>

<tr>
<td>
<pre>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 74LS154&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +-------+&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MemSel*------|G1* Y0*|-----------------,
A15---------,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; J9--o&lt;|-+---|G2*&nbsp; . |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |
&nbsp;&nbsp;&nbsp; 74LS04&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; . |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |
WE*---|>o---=|)--,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; . |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 74LS08 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ,-----------------|---|S0&nbsp;&nbsp; . |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | ,---------------|---|S1&nbsp;&nbsp; . |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +-------+&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 74LS612&nbsp;&nbsp;&nbsp; | |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A15----|---|S2&nbsp;&nbsp; . |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; LE*|--'&nbsp;&nbsp;&nbsp; +-----------+&nbsp; | |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | ,-|S3 Y15*|---------------, |
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MO10|--' |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | | +-------+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | |
&nbsp;D7---|D1&nbsp;&nbsp; Q1|-------|D0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MO8|----'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | |
&nbsp;D6---|D6&nbsp;&nbsp; Q6|-------|D1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +-----+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | |
&nbsp;D5---|D3&nbsp;&nbsp; Q3|-------|D2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | Bit3-|G*&nbsp;&nbsp; |&nbsp; lnk&nbsp; | | 10K&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +----------+&nbsp; | |
&nbsp;D4---|D4&nbsp;&nbsp; Q4|-------|D3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; M03|------|A2 Y2|--o o--+-|-WWW-,&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CS*|--' |
&nbsp;&nbsp;&nbsp; ,-|D0&nbsp;&nbsp; Q0|&nbsp; D0---|D4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MO2|-|>o--|A3 Y3|--o o----+-WWW-+&nbsp;&nbsp; +----------+ |&nbsp;&nbsp;&nbsp; |
&nbsp;&nbsp;&nbsp; +-|D2&nbsp;&nbsp; Q2|&nbsp; D1---|D5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MO0|------|A1 Y1|-+---------WWW-+&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CS*|------'
&nbsp;Gnd+-|D5&nbsp;&nbsp; Q5|&nbsp; D2---|D6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; M01|------|A0 Y0|-|-+-------WWW-+&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | |&nbsp;
&nbsp;&nbsp;&nbsp; '-|D7&nbsp;&nbsp; Q4|&nbsp; D3---|D7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +-----+ | | +-----+&nbsp; Gnd&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; D7| |---D0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp; D4---|D8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | '-|A7 Y7|-------|A18&nbsp;&nbsp;&nbsp;&nbsp; D6| |---D1
Gnd---|OE*&nbsp;&nbsp;&nbsp; |&nbsp; D5---|D9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; '---|A1 Y1|-------|A17&nbsp;&nbsp;&nbsp;&nbsp; D5| |---D2
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +-------+&nbsp; D6---|D10&nbsp;&nbsp;&nbsp;&nbsp; MO4|------------------|A6 Y6|-------|A16&nbsp;&nbsp;&nbsp;&nbsp; D4| |---D3
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 74LS373&nbsp;&nbsp; D7---|D11&nbsp;&nbsp;&nbsp;&nbsp; MO5|------------------|A5 Y5|-------|A15&nbsp;&nbsp;&nbsp;&nbsp; D3| |---D4
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MO6|------------------|A0 Y0|-------|A14&nbsp;&nbsp;&nbsp;&nbsp; D2| |---D5
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A11---|RS0&nbsp;&nbsp;&nbsp;&nbsp; MO7|------------------|A4 Y4|-------|A13&nbsp;&nbsp;&nbsp;&nbsp; D1| |---D6
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A12---|RS1&nbsp;&nbsp;&nbsp;&nbsp; MO9|------------------|A2 Y2|-------|A12&nbsp;&nbsp;&nbsp;&nbsp; D0| |---D7
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A13---|RS2&nbsp;&nbsp;&nbsp; MO11|------------------|A3 Y3|-------|A11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | |
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A14---|RS3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +-----+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | |
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A4---|A10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | |
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A0---|MA0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A5---|A9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | |
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A1---|MA1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A6---|A8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | |
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A2---|MA2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A7---|A7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | |
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A3---|MA3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A8---|A6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | |
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A9---|A5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | |
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -|C&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A10---|A4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | |
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WE*---|STB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A11---|A3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | |&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DBIN---|R/W*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A12---|A2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | |
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MapSel*---|CS*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A13---|A1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | |
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MemSel*---|ME*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A14---|A0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | |
&nbsp;Bit1-----------------|MM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WE*---|R/W*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |-+
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +-----------+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dbin---|>o---|>------|OE*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 04&nbsp;&nbsp;&nbsp; 244&nbsp;&nbsp;&nbsp;&nbsp; +----------+
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (16x) 512K SRAM/EEPROM</pre>
</td>
</tr>
</table>

<p>The mapper takes its input from the PE-box data bus. Which is a problem
since the mapper has a 12-bit bus, whereas the PE-box has a multiplexed
2 x 8-bit bus. This is the reason for the 74LS373: it latches the first
(most significant) byte when it is written and presents it to the D0-D3
inputs of the mapper. The D4-D11 inputs of the mapper are connected to
the data bus, and will thus input both bytes in sequence since the STB
pin is controlled by WE*, which is pulsed low upon writing. When the second
byte is written, it overwrites the first one in the mappers memory. The
mapper thus latches the least significant byte via D4-D11, and the most
significant one (well, 4 bits of it anyway) via D0-D3.
<p>The inputs RS0-RS3 determine in which register the data will be written.
Since they are connected to A11-A14, the registers will thus map one word
apart: >xxx0 through >xx1E. As described <a href="#mapping control">above</a>,
the dedicated MapSel* signal enables bus operations via the CS* input,
whereas the MemSel* signal enables memory mapping via the ME* input.
<p>The inputs MA0-MA3 determine which register should send its data to
the outputs MO0-MO11. These inputs are connected to address lines A0-A3,
so the register will be selected by the most significant nibble of the
address: >0xxx, >1xxx, through >Fxxx. At least this is what happens when
the MM input is high. Things are different when MM is low, which it is
at power-up time since it is driven by CRU bit 1 (all CRU bits are low
upon reset). When MM is low, the mapper is in "transparent" mode, the outputs
MO0-MO7 are kept low, and the outputs MO8-MO11 reflect the values present
on MA0-MA3.
<p>The 12 outputs from the mapper, together with the 12 least-significant
address lines from the PE-box bus, form a 24-bit expanded address, which
corresponds to 16 Megabytes. Since memory chips are 512 kbytes each, we
will need 32 of them, activated by two piggybacked 74LS154 decoders. The
PE-box address lines A4-A14, and the mapper outputs MO0,MO1,MO4-MO7,MO9
and MO11 are connected to the memory chips address pins. Address line A15
and mapper's outputs MO2, MO8, and MO10 are connected to the S0-S3 selection
inputs of the 74LS154 decoders. Output MO3 enables the bottom 74LS154 decoder
through its G2* input. It is also inverted by a 74LS05 and presented to
jumper J9. This is meant to control the piggy-backed 74LS154 decoder.
<p>The memory chips are meant to be mounted in four layers. MO2 and MO3
control the layer number. Within each layer chips are arranged in pairs,
one for the odd-numbered byte, one for the even-numbered byte (this simplifies
writing to EEPROM chips). Line A15 serves as the byte selector. MO8 and
MO10 determine which pair of chips will be used. This complicated layout
is necessary so that, upon power-up, you can have EEPROM in some memory
areas and SRAM in others.
<p>You will note that MO0-MO3 are buffered by a '244 controlled by CRU
bit 3. This is for compatibility with the original SAMS card. When CRU
bit 6 is high (which is not the case upon power-up), the '244 is not conducting
and all its output are brought low by four 10K pull-down resistors. This
means that, in SAMS-compatible mode, layer 1 is the only one selected.
In addition, only the lower 64K in each chip will be accessed, which gives
us a total of 1 megabyte.
<p>You may wonder why MO2 is inverted before the buffer. This is done so
that, when the mapper is in transparent mode (i.e. MO0-MO3 are low), the
second layer is selected. This way, the SAMS-compatibility layer (the first
one) is not the same as the power-up layer (the second one). Also note
the two links LNK1 and LNK2 on the layer selection lines. They're here
to ensure that you do not select non-existent chips, in case you have less
than 4 layers of chips. With only one layer, leave both links open: all
requests will be redirected to the first layer. With two layers, bridge
only LNK2 (the MO2 line). With 3 or 4 layers brigde both links. Beware
that with 3 layers only, it is possible to select non-existent chips.
<p>I am not sure that the second 74ABT244 buffer is really necessary. I
included it because I was afraid that the 74LS612 mapper would not be strong
enough to control 32 chips, although this should not be a problem with
the CMOS version. So it may be possible to dispense with that buffer, but
I haven't verified it. For the same reason, after DBIN is inverted with
a 74LS04, it is buffered by a 74ABT244 before being applied to the OE*
pin of the memory chips. The R/W* pin receives WE*, which has been buffered
by the same 74ABT244.
<br>&nbsp;
<h4>
<a NAME="dip switch"></a>DIP-switch settings</h4>
The board comprises a 8-switch dual-in-line-package (DIP) switch, which
is used to preset several options, as well as to choose the CRU address
to which the board should answer. To find the CRU address, add up the weight
of those switches that are open and add >1000 to the total. For instance,
to get >1600 you would set the last 4 switches as follows: close-open-open-close.
<br>&nbsp;
<table BORDER >
<tr>
<td><b>#</b></td>

<td><b>Open</b></td>

<td><b>Close</b></td>
</tr>

<tr>
<td>1</td>

<td>Ignore requests at&nbsp; >8000-83FF&nbsp;</td>

<td>Answer at >8000-83FF depends on CRU bit 6&nbsp;</td>
</tr>

<tr>
<td>2</td>

<td>Ignore requests at&nbsp; >0000-1FFF</td>

<td>Answer at >0000-1FFF depends on CRU bit 2&nbsp;</td>
</tr>

<tr>
<td>3</td>

<td>Ignore memory expansion space&nbsp;</td>

<td>Answer in memory expansion space&nbsp;</td>
</tr>

<tr>
<td>4</td>

<td>Not used</td>

<td>Not used</td>
</tr>

<tr>
<td>5</td>

<td>CRU address&nbsp; >x8xx&nbsp;</td>

<td>Ignored in CRU address&nbsp;</td>
</tr>

<tr>
<td>6</td>

<td>CRU address&nbsp; >x4xx</td>

<td>Ignored in&nbsp; CRU address</td>
</tr>

<tr>
<td>7</td>

<td>CRU address&nbsp; >x2xx</td>

<td>Ignored in CRU address</td>
</tr>

<tr>
<td>8</td>

<td>CRU address&nbsp; >x1xx</td>

<td>Ignored in CRU address</td>
</tr>
</table>

<br>&nbsp;
<br>&nbsp;
<h2>
<a NAME="Building it"></a>Building the board</h2>

<h4>
<a NAME="components"></a>List of components</h4>
U1: 74LS612&nbsp; or 74HCT612
<br>U2: 74ABT245 or 74BCT245
<br>U3, U4, U5: 74ABT244 or 74BCT244
<br>U6: 74LS688
<br>U7: 74LS259
<br>U8: 74LS151
<br>U9: 74LS138
<br>U10: 74LS30
<br>U11: 74LS373
<br>U12: 74LS154 (two, if more than 8 Megs desired)
<br>U13: 74LS125
<br>U14: 74LS08
<br>U15: 74LS32
<br>U16: 74LS05
<br>U17: 78M05
<br>U20: 74ABT244 or 74BCT244
<br>U100 to U107: upto 32 512K chip, either SRAM or Flash-EEPROMs (e.g.
29F040 or 29C040, see <a href="#programming EEPROMs">below</a>)
<p>SW1: 8-DIP switch
<br>SW2: SPST switch
<br>Console modification: two mini SPDT switches
<p>R1: 6-SIP resistor network, 5x 10K
<br>R2: 10-SIP resistor network, 9x 4K7
<br>R3: resistor 100 ohms
<br>R4: resistor 4K7
<br>C1 to C19: 100 nF capacitors
<br>C20: electrolytic capacitor, 100 uF
<br>&nbsp;
<p>The board should support four layers of memory chips, each layer comprising
8 chips of 512 K. This gives us a grand total of 16 megabytes. Note that
I haven't verified that the address and data bus drivers are strong enough
to control that many chips. To be on the safe side, I recommend that you
install 74ABT244 and 74ABT245 instead of the LS versions (the BCT version
might work too).
<p>You could use pretty much any type of 512K SRAM chips, in a 32-pin DIP
or CDIP package. You may also use 512K Flash-EEPROMs, if you want to, also
in 32-pin DIP packages. Before buying, make sure that the chip&nbsp; match
the following pinouts:
<pre>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SRAM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; EEPROM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; HAMS PCB
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +---+--+---+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +---+--+---+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +---+--+---+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |A18&nbsp;&nbsp;&nbsp; Vcc|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |A18&nbsp;&nbsp;&nbsp; Vcc|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |A18&nbsp;&nbsp;&nbsp; Vcc|
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |A16&nbsp;&nbsp;&nbsp; <font color="#FF0000">A15|&lt;</font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |A16&nbsp;&nbsp;&nbsp; <font color="#3333FF">WE*|&lt;</font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |A16&nbsp;&nbsp;&nbsp; <font color="#CC33CC">A14|&lt;
</font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#FF0000">>|A14</font>&nbsp;&nbsp;&nbsp; A17|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#3333FF">>|A15</font>&nbsp;&nbsp;&nbsp; A17|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#3333FF">>|A15</font>&nbsp;&nbsp;&nbsp; A17|
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |A12&nbsp;&nbsp;&nbsp; <font color="#FF0000">WE*|&lt;</font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |A12&nbsp;&nbsp;&nbsp; <font color="#3333FF">A14|&lt;</font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |A12&nbsp;&nbsp;&nbsp; <font color="#FF0000">WE*|&lt;
</font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |A7&nbsp;&nbsp;&nbsp;&nbsp; A13|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |A7&nbsp;&nbsp;&nbsp;&nbsp; A13|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |A7&nbsp;&nbsp;&nbsp;&nbsp; A13|
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |A6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A8|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |A6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A8|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |A6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A8|
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |A5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A9|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |A5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A9|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |A5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A9|
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |A4&nbsp;&nbsp;&nbsp;&nbsp; A11|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |A4&nbsp;&nbsp;&nbsp;&nbsp; A11|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |A4&nbsp;&nbsp;&nbsp;&nbsp; A11|
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |A3&nbsp;&nbsp;&nbsp;&nbsp; OE*|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |A3&nbsp;&nbsp;&nbsp;&nbsp; OE*|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |A3&nbsp;&nbsp;&nbsp;&nbsp; OE*|
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |A2&nbsp;&nbsp;&nbsp;&nbsp; A10|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |A2&nbsp;&nbsp;&nbsp;&nbsp; A10|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |A2&nbsp;&nbsp;&nbsp;&nbsp; A10|
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |A1&nbsp;&nbsp;&nbsp;&nbsp; CS*|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |A1&nbsp;&nbsp;&nbsp;&nbsp; CS*|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |A1&nbsp;&nbsp;&nbsp;&nbsp; CS*|
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |A0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; D7|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |A0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; D7|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |A0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; D7|
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |D0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; D6|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |D0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; D6|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |D0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; D6|
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |D1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; D5|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |D1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; D5|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |D1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; D5|
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |D2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; D4|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |D2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; D4|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |D2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; D4|
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |Gnd&nbsp;&nbsp;&nbsp;&nbsp; D3|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |Gnd&nbsp;&nbsp;&nbsp;&nbsp; D3|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |Gnd&nbsp;&nbsp;&nbsp;&nbsp; D3|
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +----------+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +----------+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +----------+</pre>
You will have noticed three differences in pinout between SRAM chips and
EEPROM chips: pins #3, #29 and #31. This is quite unfortunate, but we have
to live with it.
<p>As you can see, the HAMS board uses a hybrid pinout. SRAM chips don't
care about address pin numbering (all addresses are equivalent), but EEPROMs
do (because you have to write a validation code at precise addresses),
so I decided that pin #3 would be A15, like in EEPROMs. No such compromise
was possible for the WE* pin, which means that you'll need to do some hand
wiring for either SRAMs or EEPROM. I reasonned that you will likely install
more SRAM than EEPROM, so the WE* pin matches the SRAM pinout. When installing
an EEPROM, you will need to cross-wire the WE* and A14 pins.
<br>&nbsp;
<h3>
<a NAME="Installing memory"></a>Installing memory chips</h3>
The first layer should contain only SRAM chips, for compatibility with
the SAMS design.
<p>On the second layer, U100 and U104 (the two chips on the left) should
be EEPROMs, all other chips should be SRAM. This allows for the presence
of persistent code in the card DSR area (>4000-5FFF) and in the console
ROM area (>0000-1FFF). Should you want to override the console ROMs, the
computer would boot from these EEPROMs.
<p>The third and fourth layers can contain any combination of SRAM and
EEPROM that you fancy. Just make sure that chips that are in the same column
are of the same type: U100 and U104, U101 and U105, U102 and U106, U103
and U107. This is because each pair of chips implement the even and odd
bytes of the same word.
<p>If you have more that one layer, you should bridge LNK1.
<p>If you have more than two layers, you should bridge both LNK1 and LNK2.
You should also piggyback a second '154 on top of the first one. Bend out
pins #1 though 11, and 13 through 17, these will be connected to the memory
chips (pin #22) with wires. Also bend out pin #19 and connect it to J9
with a piece of wire.
<p>Memory chips in layer 2 should have their pin #22 bent out, rather than
soldered to the underlying chips. Connect pins #22 of the piggybacked U100
through U107 to jumpers J1 through J8, respectively.
<p>Memory chips in layer 3 and 4 should also have their pin #22 bent out.
They should be connected directly to bent out pins of the piggybacked '154.
<p>IMPORTANT: Remember that the pinout of EEPROMs does not exactly match
that of SRAMs. So, any time you install an EEPROM chip, you MUST bend out
its pins #29 and 31. Use short pieces of jumper wire to invert the connections
of these two pins. You will notice that the PCB contains small holes next
these pins, to which you can solder these wires. So, connect bent out pin
#29 to the hole next to pin #31, and connect bent out pin #31 to the hole
next to pin #29.
<br>&nbsp;
<h4>
<a NAME="wiring summary"></a>Summary of memory chips wiring</h4>

<pre>Layer Chip&nbsp;&nbsp; Connect pin #22 to
----&nbsp; ----&nbsp;&nbsp; ------------------
1&nbsp;&nbsp;&nbsp;&nbsp; Any&nbsp;&nbsp;&nbsp; Built-in</pre>

<pre>2&nbsp;&nbsp;&nbsp;&nbsp; U100&nbsp;&nbsp; J1
2&nbsp;&nbsp;&nbsp;&nbsp; U101&nbsp;&nbsp; J2
2&nbsp;&nbsp;&nbsp;&nbsp; U102&nbsp;&nbsp; J3
2&nbsp;&nbsp;&nbsp;&nbsp; U103&nbsp;&nbsp; J4
2&nbsp;&nbsp;&nbsp;&nbsp; U104&nbsp;&nbsp; J5
2&nbsp;&nbsp;&nbsp;&nbsp; U105&nbsp;&nbsp; J6
2&nbsp;&nbsp;&nbsp;&nbsp; U106&nbsp;&nbsp; J7
2&nbsp;&nbsp;&nbsp;&nbsp; U107&nbsp;&nbsp; J8</pre>

<pre>3&nbsp;&nbsp;&nbsp;&nbsp; U100&nbsp;&nbsp; 74LS154 pin #1
3&nbsp;&nbsp;&nbsp;&nbsp; U101&nbsp;&nbsp; 74LS154 pin #2
3&nbsp;&nbsp;&nbsp;&nbsp; U102&nbsp;&nbsp; 74LS154 pin #3
3&nbsp;&nbsp;&nbsp;&nbsp; U103&nbsp;&nbsp; 74LS154 pin #4
3&nbsp;&nbsp;&nbsp;&nbsp; U104&nbsp;&nbsp; 74LS154 pin #5
3&nbsp;&nbsp;&nbsp;&nbsp; U105&nbsp;&nbsp; 74LS154 pin #6
3&nbsp;&nbsp;&nbsp;&nbsp; U106&nbsp;&nbsp; 74LS154 pin #7
3&nbsp;&nbsp;&nbsp;&nbsp; U107&nbsp;&nbsp; 74LS154 pin #8</pre>

<pre>4&nbsp;&nbsp;&nbsp;&nbsp; U100&nbsp;&nbsp; 74LS154 pin #9
4&nbsp;&nbsp;&nbsp;&nbsp; U101&nbsp;&nbsp; 74LS154 pin #10
4&nbsp;&nbsp;&nbsp;&nbsp; U102&nbsp;&nbsp; 74LS154 pin #11
4&nbsp;&nbsp;&nbsp;&nbsp; U103&nbsp;&nbsp; 74LS154 pin #13
4&nbsp;&nbsp;&nbsp;&nbsp; U104&nbsp;&nbsp; 74LS154 pin #14
4&nbsp;&nbsp;&nbsp;&nbsp; U105&nbsp;&nbsp; 74LS154 pin #15
4&nbsp;&nbsp;&nbsp;&nbsp; U106&nbsp;&nbsp; 74LS154 pin #16
4&nbsp;&nbsp;&nbsp;&nbsp; U107&nbsp;&nbsp; 74LS154 pin #17</pre>

<p><br>The wiring of the piggybacked 154 should look like this:
<pre>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +---+--+---+&nbsp;
Layer 3, U100|1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 24|<font color="#00CC00">]
</font>Layer 3, U101|2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 23|<font color="#00CC00">]
</font>Layer 3, U102|3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 22|<font color="#00CC00">]
</font>Layer 3, U103|4&nbsp; U12&nbsp; 21|<font color="#00CC00">]
</font>Layer 3, U104|5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 20|<font color="#00CC00">]
</font>Layer 3, U105|6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 19|J9
Layer 3, U106|7&nbsp; 154&nbsp; 18|<font color="#00CC00">]
</font>Layer 3, U107|8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 17|Layer 4, U107
Layer 4, U100|9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 16|Layer 4, U106
Layer 4, U101|10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 15|Layer 4, U105
Layer 4, U102|11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 14|Layer 4, U104
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#00CC00">[</font>|12&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 13|Layer 4, U103
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +----------+</pre>
Unlabelled pins should be soldered to the underlying '154 (which I symbolized
with green [ and ] marks).
<br>&nbsp;
<h3>
<a NAME="console mod"></a>Console modifications</h3>
If you would like the card to override the console ROMs or the console
RAM "scratch-pad", you will need to perform a small modification on your
console. Nothing drastic, just installing a couple of switches to disable
the ROM/RAM and enable the data bus multiplexer. The switches are not strictly
necessary: you could make the modification permanent. However, this would
mean that your modified console can only work with a HAMS card in the PE-box.
By using switches, you can toggle between a normal console and a modified
one. I thus recommend that you install switches.
<p>You'll need two small SPDT switches (single pole, dual terminal). Alternatively,
you may get a DPDT switch (dual pole, dual terminal), which would let you
control ROM and RAM together. Personally, I prefer the idea of having two
switches, as it gives you more flexibility, but it's up to you.
<p>First, open your console. Refer to my <a href="surgery.htm">console
surgery guide</a> if you need to.
<br>The switches are best installed at the back of the console, towards
the right (i.e. near the side port). Drill two small holes of the appropriate
diameter in the back of the console and fit the switches in. Make sure
they won't make contact with anything inside.
<br>&nbsp;
<h4>
Intstalling the ROM switch</h4>

<ul>
<li>
Locate U504 on the motherboard. It is a 74LS138 located near the side port,
on the first row of chips (caution: there is another 74LS138 in the second
row, but that's not the one you want).</li>

<li>
Cut out pin #15 as close to the board as possible, and bend it out. It's
the second from the top right of the chip (the top of the chip is marked
with a small notch, or a white dot).</li>

<li>
Remove the stump of the pin from the motherboard and solder a wire in its
place. The other end of the wire should go to the middle pole of your "ROM"
switch.</li>

<li>
Connect a second wire to bent out pin #15. Insulate it with some tape,
to make sure it won't make contact with the metal shell or anything else.
This wire should go the one terminal of the "ROM" switch.</li>

<li>
Connect the other terminal of the "ROM" switch to +5 volts. You can find
it on the top right pin of any 74LS chip.</li>
</ul>
When the switch connects the middle pole to the +5 volts terminal, the
console ROMs are disabled and the data bus multiplexer is enabled for operations
in the range >0000-1FFF.
<br>&nbsp;
<h4>
Installing the RAM switch.</h4>

<ul>
<li>
Locate U507 on the motherboard. It is a 74LS32 located near the side port,
parallel to the back of the board.</li>

<li>
Cut out pin #8 as close to the board as possible, and bend it out. It's
the first pin from the bottom on the right side of the chip (the top of
the chip is marked with a small notch, or a white dot).</li>

<li>
Remove the stump of the pin from the motherboard and solder a wire in its
place. The other end of the wire should go to the middle pole of your "RAM"
switch.</li>

<li>
Connect a second wire to bent out pin #8. Insulate it with some tape, to
make sure it won't make contact with the metal shell. This wire should
go the one terminal of the "RAM" switch.</li>

<li>
Connect the other terminal of the "RAM" switch to +5 volts. You can find
it on the top right pin of any 74LS chip or on the "ROM" switch, if you
have installed it.</li>
</ul>
When the switch connects the middle pole to the +5 volts terminal, the
console RAMs are disabled and the data bus multiplexer is enabled for operations
in the range >8000-83FF.
<br>&nbsp;
<h4>
Intalling a DPDT switch</h4>
Perform the two modifications above, just solder the wires to the different
halves of the DPDT switch. Make sure +5 volts is on the same side for both.
<br>&nbsp;
<h4>
Summary</h4>
This is how to wire the switch(es)
<pre>U504,hole #15------,
U504,pin #15-----o o o----+--+5V
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |
U507,pin #8------o o o----'
U507, hole #8------'</pre>

<p><br>And here is a map of the motherboard near the side port, with the
pins to cut marked with <font color="#FF0000">X</font> and possible sources
+5 volts marked with <font color="#3333FF">5</font>.
<pre>&nbsp;&nbsp; __
&nbsp;__|&nbsp; |
|&nbsp;&nbsp;&nbsp;&nbsp; |__________________________________________
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 74LS04&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 74LS03&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +-,_,-+&nbsp;&nbsp;&nbsp;&nbsp; +-,_,-+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +--------------+&nbsp;
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; <font color="#3333FF">5</font>|&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; <font color="#3333FF">5</font>|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp; 74LS32&nbsp;&nbsp;&nbsp; ,|&nbsp;
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; U507&nbsp;&nbsp;&nbsp;&nbsp; '|&nbsp;
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +<font color="#FF0000">X</font>-------------+&nbsp;
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; +-,_,-+&nbsp;&nbsp;
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; <font color="#3333FF">5</font>|
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +-----+&nbsp;&nbsp;&nbsp;&nbsp; +-----+&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +-,_,-+&nbsp;&nbsp;&nbsp;&nbsp; +-,_,-+&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; <font color="#3333FF">5</font>|&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; <font color="#3333FF">5</font>|&nbsp;&nbsp;&nbsp;&nbsp; | 74&nbsp; |&nbsp;&nbsp;
\___&nbsp;&nbsp;&nbsp; | 74 <font color="#FF0000">X</font>|&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; | LS&nbsp; |&nbsp;
&nbsp;___|&nbsp;&nbsp; | LS&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; | 367 |&nbsp;
|===&nbsp;&nbsp;&nbsp; | 138 |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; +-----+&nbsp;&nbsp;
|===&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; +-,_,-+&nbsp;
|===&nbsp;&nbsp;&nbsp; |U504 |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; <font color="#3333FF">5</font>|&nbsp;&nbsp;&nbsp;
|===&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;
|===&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |
|===&nbsp;&nbsp;&nbsp; +-----+&nbsp;&nbsp;&nbsp;&nbsp; +-----+&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |
|===&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +-,_,-+ 74LS138&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;
|===&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; <font color="#3333FF">5</font>|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |
|===&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;
|=== S&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|=== I&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +-----+&nbsp;
|=== D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 74LS367&nbsp;&nbsp;
|=== E&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|===&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|=== P&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|=== O&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|=== R&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|=== T&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +-----+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|===&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 74LS244&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|===</pre>
&nbsp;
<h2>
<a NAME="Software"></a>Software issues</h2>

<h4>
<a NAME="switching pages"></a>Switching pages</h4>
If you set CRU bit 0 and CRU bit 4 to '1' the mapper's registers appear
at >4000-5FFF. If you leave CRU bit 4 as '0', the registers are only available
through addresses >5FE0-5FFF. Since the latter addresses work in both cases,
I suggest you always use them within your programs. The main purpose of
CRU bit 4 is to enable compatibility with programs written for the SAMS
card, which are likely to use addresses >4000-401F to access the mapper.
<p>Now write the desired page number in appropriate register, according
to the table below.
<pre>Write at&nbsp;&nbsp; Controls memory at
--------&nbsp;&nbsp; ------------------
>5FE0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; >0000-0FFF
>5FE2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; >1000-1FFF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
>5FE4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; >2000-2FFF
>5FE6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; >3000-3FFF
>5FE8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; >4000-4FFF
>5FEA&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; >5000-5FFF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
>5FEC&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; >6000-6FFF
>5FEE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; >7000-7FFF
>5FF0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; >8000-8FFF (only used upto >83FF)
>5FF2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; >9000-9FFF (not used)&nbsp;&nbsp;&nbsp;&nbsp;
>5FF4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; >A000-AFFF
>5FF6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; >B000-BFFF
>5FF8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; >C000-CFFF
>5FFA&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; >D000-DFFF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
>5FFC&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; >E000-EFFF
>5FFE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; >F000-FFFF</pre>
Once done, you can set CRU bit 0 back to '0' (and possibly bit 4 too).
You may now enable mapping by setting CRU bit 1 to '1'.
<p>Note that the only the least significant byte of a page number can be
read back. If you would like to keep track of the most significant digit,
you should save a copy of the 16 registers somewhere in memory. Fortunately,
with a total of 16 megs available, memory is not an issue!
<br>&nbsp;
<table CELLSPACING=2 CELLPADDING=2 BGCOLOR="#E6E6E6" >
<caption><tbody>
<br></tbody></caption>

<tr>
<td>
<pre><tt>*--------------------------------------
* This routine selects a page into a given address block
* R0 = page number
* R1 = address where it should appear (only first nibble considered)
* R12 = CRU address of the card
*--------------------------------------
SETPG&nbsp; SBO&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; access card in DSR space
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SBO&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set mapping mode
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SRL&nbsp;&nbsp;&nbsp; R1,12&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; keep only first nibble
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SLA&nbsp;&nbsp;&nbsp; R1,1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; make it a word
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MOV&nbsp;&nbsp;&nbsp; R0,@>5FE0(R1)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set the page (use safe address)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MOV&nbsp;&nbsp;&nbsp; R0,@REGS(R1)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; remember for later (optional)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SBZ&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DSR space off
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; B&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *R11&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
REGS&nbsp;&nbsp; DATA&nbsp;&nbsp; -1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1&nbsp;&nbsp;&nbsp;
*&nbsp;
*--------------------------------------
* This routine finds which page maps into a given address block
* R0 = page number. Negative if register doesn't match memorized value&nbsp;&nbsp;
* R1 = address tested
* R12 = CRU address of the card
*--------------------------------------
SETPG&nbsp; SBO&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; access card in DSR space
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SRL&nbsp;&nbsp;&nbsp; R1,12&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; keep only first nibble
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SLA&nbsp;&nbsp;&nbsp; R1,1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; make it a word
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MOV&nbsp;&nbsp;&nbsp; @>5FE0(R1),R0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get the page (use safe address)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SWPB&nbsp;&nbsp; R0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CB&nbsp;&nbsp;&nbsp;&nbsp; R0,@REGS+1(R1)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; compare with memorized value lsb
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JEQ&nbsp;&nbsp;&nbsp; SK20&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ok
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SRL&nbsp;&nbsp;&nbsp; R0,8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; not the same: use register value
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NEG&nbsp;&nbsp;&nbsp; R0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; but negated to indicate missing msb
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JMP&nbsp;&nbsp;&nbsp; SK21
SK20&nbsp;&nbsp; MOV&nbsp;&nbsp;&nbsp; @REGS(R1),R0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return memorized value&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
SK21&nbsp;&nbsp; SBZ&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DSR space off
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; B&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *R11&nbsp;&nbsp;</tt></pre>
</td>
</tr>

<tr>
<td></td>
</tr>
</table>

<h4>
<a NAME="page numbering"></a>Page number decoding</h4>
The least significan digit of the page number is used to select chips within
a given layer. This is necessary because it is the only digit that varies
with the address when the mapper is in "transparent" mode. Thus, adresses
>0000-0FFF in the TI-99/4a will appear as page 0, addresses >1000-1FFF
as page 1, etc.
<pre>Page&nbsp; Address&nbsp;&nbsp; Chip&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
----&nbsp; ------- ---------
xx0&nbsp;&nbsp; 00000&nbsp;&nbsp; U100/U104&nbsp;&nbsp;
xx1&nbsp;&nbsp; 00800&nbsp;&nbsp; U100/U104&nbsp;&nbsp;
xx2&nbsp;&nbsp; 00000&nbsp;&nbsp; U101/U105&nbsp;&nbsp;
xx3&nbsp;&nbsp; 00800&nbsp;&nbsp; U101/U105&nbsp;&nbsp;
xx4&nbsp;&nbsp; 01000&nbsp;&nbsp; U100/U104&nbsp;&nbsp;
xx5&nbsp;&nbsp; 01800&nbsp;&nbsp; U100/U104&nbsp;&nbsp;
xx6&nbsp;&nbsp; 01000&nbsp;&nbsp; U101/U105&nbsp;&nbsp;
xx7&nbsp;&nbsp; 01800&nbsp;&nbsp; U101/U105&nbsp;&nbsp;
xx8&nbsp;&nbsp; 00000&nbsp;&nbsp; U102/U106&nbsp;&nbsp;
xx9&nbsp;&nbsp; 00800&nbsp;&nbsp; U102/U106&nbsp;&nbsp;
xxA&nbsp;&nbsp; 00000&nbsp;&nbsp; U103/U107&nbsp;&nbsp;
xxB&nbsp;&nbsp; 00800&nbsp;&nbsp; U103/U107&nbsp;&nbsp;
xxC&nbsp;&nbsp; 01000&nbsp;&nbsp; U102/U106&nbsp;&nbsp;
xxD&nbsp;&nbsp; 01800&nbsp;&nbsp; U102/U106&nbsp;&nbsp;
xxE&nbsp;&nbsp; 01000&nbsp;&nbsp; U103/U107&nbsp;&nbsp;
xxF&nbsp;&nbsp; 01800&nbsp;&nbsp; U103/U107</pre>

<pre>NB Even bytes go into U100-U103, odd bytes into U104-U107</pre>
The middle digit in the page number only affect the internal memory address
within a given chip.
<pre>Page&nbsp; Address
----&nbsp; -------
x0x&nbsp;&nbsp; 00000
x1x&nbsp;&nbsp; 02000
x2x&nbsp;&nbsp; 04000
x3x&nbsp;&nbsp; 06000
x4x&nbsp;&nbsp; 08000
x5x&nbsp;&nbsp; 0A000
x6x&nbsp;&nbsp; 0C000
x7x&nbsp;&nbsp; 0E000
x8x&nbsp;&nbsp; 10000
x9x&nbsp;&nbsp; 12000

xAx&nbsp;&nbsp; 14000
xBx&nbsp;&nbsp; 16000
xCx&nbsp;&nbsp; 18000
xDx&nbsp;&nbsp; 1A000
xEx&nbsp;&nbsp; 1C000
xFx&nbsp;&nbsp; 1E000</pre>
The most significant digit in the page number encodes the most significant
part of the memory address, as well as the chip layer. If you have only
one layer, pages >400 through >FFF are not used. Leaving both LNK1 and
LNK2 open ensures that all pages will map to layer one (i.e. pages >400,
>800 and >C00 are equivalent to page >000). With only two layers of chips
(LNK1 bridged and LNK2 open), pages >800 through >FFF are equivalent to
pages >000 through >7FF. Be careful that with only three layers of chips
(LNK1 and LNK2 bridged), pages >800 through >BFF will not map anywhere!
<p>Layer 2 is selected by default upon power-up. Layer 1 is the only layer
accessible when the SAMS compatibility bit is set.
<pre>Page&nbsp; Address&nbsp; Layer
----&nbsp; -------&nbsp; -----
0xx&nbsp;&nbsp; 00000&nbsp;&nbsp;&nbsp; 2
1xx&nbsp;&nbsp; 20000&nbsp;&nbsp;&nbsp; 2
2xx&nbsp;&nbsp; 40000&nbsp;&nbsp;&nbsp; 2
3xx&nbsp;&nbsp; 60000&nbsp;&nbsp;&nbsp; 2
4xx&nbsp;&nbsp; 00000&nbsp;&nbsp;&nbsp; 1
5xx&nbsp;&nbsp; 20000&nbsp;&nbsp;&nbsp; 1
6xx&nbsp;&nbsp; 40000&nbsp;&nbsp;&nbsp; 1
7xx&nbsp;&nbsp; 60000&nbsp;&nbsp;&nbsp; 1
8xx&nbsp;&nbsp; 00000&nbsp;&nbsp;&nbsp; 4
9xx&nbsp;&nbsp; 20000&nbsp;&nbsp;&nbsp; 4
Axx&nbsp;&nbsp; 40000&nbsp;&nbsp;&nbsp; 4
Bxx&nbsp;&nbsp; 60000&nbsp;&nbsp;&nbsp; 4
Cxx&nbsp;&nbsp; 00000&nbsp;&nbsp;&nbsp; 3
Dxx&nbsp;&nbsp; 20000&nbsp;&nbsp;&nbsp; 3
Exx&nbsp;&nbsp; 40000&nbsp;&nbsp;&nbsp; 3
Fxx&nbsp;&nbsp; 60000&nbsp;&nbsp;&nbsp; 3</pre>
To find the memory address within a chip (range >00000 to >7FFFF), add
up the 'address' values obtained from all three tables.
<p>The following assembly routines convert a page number + offset in page
into a chip number + address in chip, and conversely. They may become handy
when trying to determine whether a given page is RAM or EEPROM, or when
trying to write an unlocking code to a precise adddress in a given EEPROM
chip, respectively.
<br>&nbsp;
<table CELLSPACING=2 CELLPADDING=2 BGCOLOR="#E6E6E6" >
<caption><tbody>
<br></tbody></caption>

<tr>
<td>
<pre><tt>*--------------------------------------
* This routine converts chip:address into page:offset
* R2msb = chip pair number >0-F (from left to right, bottom to top layer)
* R2lsb+R3 = address in chip >000000-07FFFF
*&nbsp;
* R0 = page number >0000-0FFF
* R1 = offset in page >0000-0FFF&nbsp;
*--------------------------------------
AD2PG&nbsp; ANDI&nbsp;&nbsp; R2,>0F07&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sanity check
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MOV&nbsp;&nbsp;&nbsp; R2,R0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MOVB&nbsp;&nbsp; R3,R0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SWPB&nbsp;&nbsp; R0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; reconstitute chip address, top 2 bytes&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SRL&nbsp;&nbsp;&nbsp; R0,1
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ANDI&nbsp;&nbsp; R0,>03F0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; keep page bits 6-11
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SRC&nbsp;&nbsp;&nbsp; R2,9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break down chip number&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JNC&nbsp;&nbsp;&nbsp; SK10
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; INCT&nbsp;&nbsp; R0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set page bit 14
SK10&nbsp;&nbsp; SRC&nbsp;&nbsp;&nbsp; R2,1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JNC&nbsp;&nbsp;&nbsp; SK11
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ORI&nbsp;&nbsp;&nbsp; R0,>0008&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set page bit 12
SK11&nbsp;&nbsp; SRC&nbsp;&nbsp;&nbsp; R2,1
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JOC&nbsp;&nbsp;&nbsp; SK12&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; invert this one
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ORI&nbsp;&nbsp;&nbsp; R0,>0400&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set page bit 5
SK12&nbsp;&nbsp; SRC&nbsp;&nbsp;&nbsp; R2,1
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JNC&nbsp;&nbsp;&nbsp; SK13
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ORI&nbsp;&nbsp;&nbsp; R0,>0800&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set page bit 4&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
SK13&nbsp;&nbsp; SRC&nbsp;&nbsp;&nbsp; R3,12&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; now break down chip address
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JNC&nbsp;&nbsp;&nbsp; SK14
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; INC&nbsp;&nbsp;&nbsp; R0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set page bit 15
SK14&nbsp;&nbsp; SRC&nbsp;&nbsp;&nbsp; R3,1
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JNC&nbsp;&nbsp;&nbsp; SK15
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ORI&nbsp;&nbsp;&nbsp; R0,>0004&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set page bit 13
SK15&nbsp;&nbsp; SRC&nbsp;&nbsp;&nbsp; R2,4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; restore R2
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SRC&nbsp;&nbsp;&nbsp; R3,3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; restore R3

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MOV&nbsp;&nbsp;&nbsp; R3,R1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get chip address
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SLA&nbsp;&nbsp;&nbsp; R1,5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; keep only 11 bits
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SRL&nbsp;&nbsp;&nbsp; R1,4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; make it an even offset
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; B&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *R11
*&nbsp;
*--------------------------------------
* This routine converts page:offset into chip:address
* R0 = page number >0000-0FFF
* R1 = offset in page >0000-0FFF
*&nbsp;
* R2msb = chip pair number >0-F (from left to right, bottom to top layer)
* R2lsb+R3 = address in chip >000000-07FFFF
*--------------------------------------
PG2AD&nbsp; ANDI&nbsp;&nbsp; R0,>0FFF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sanity check
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ANDI&nbsp;&nbsp; R1,>0FFF
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CLR&nbsp;&nbsp;&nbsp; R2
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SRC&nbsp;&nbsp;&nbsp; R0,2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; test page bit 14
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JNC&nbsp;&nbsp;&nbsp; SK1
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; INC&nbsp;&nbsp;&nbsp; R2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; put it in chip number
SK1&nbsp;&nbsp;&nbsp; SRC&nbsp;&nbsp;&nbsp; R0,2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; test page bit 12
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JNC&nbsp;&nbsp;&nbsp; SK2
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; INCT&nbsp;&nbsp; R2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; put it in chip number
SK2&nbsp;&nbsp;&nbsp; SRC&nbsp;&nbsp;&nbsp; R0,7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; test page bit 5
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JOC&nbsp;&nbsp;&nbsp; SK5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; invert it
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; C&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *R2+,*R2+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; put it in chip number
SK5&nbsp;&nbsp;&nbsp; SRC&nbsp;&nbsp;&nbsp; R0,1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; test page bit 4
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JNC&nbsp;&nbsp;&nbsp; SK6
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AI&nbsp;&nbsp;&nbsp;&nbsp; R2,>0008&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; put it in chip number
SK6&nbsp;&nbsp;&nbsp; SLA&nbsp;&nbsp;&nbsp; R2,8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; put chip number in msb
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SRC&nbsp;&nbsp;&nbsp; R0,4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; restore R0

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MOV&nbsp;&nbsp;&nbsp; R0,R3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; copy page number
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SLA&nbsp;&nbsp;&nbsp; R3,6&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SRL&nbsp;&nbsp;&nbsp; R3,13&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; keep page bits 6-8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; R3,R2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; put them in R2 lsb
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MOV&nbsp;&nbsp;&nbsp; R0,R3
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ANDI&nbsp;&nbsp; R3,>0070&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; keep only page bits 9-11
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SRL&nbsp;&nbsp;&nbsp; R3,2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; with room for two more
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SRC&nbsp;&nbsp;&nbsp; R0,1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; test page bit 15
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JNC&nbsp;&nbsp;&nbsp; SK3
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; INC&nbsp;&nbsp;&nbsp; R3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; make it lsb
SK3&nbsp;&nbsp;&nbsp; SRC&nbsp;&nbsp;&nbsp; R0,2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; test page bit 13
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JNC&nbsp;&nbsp;&nbsp; SK4
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; INCT&nbsp;&nbsp; R3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set it in chip address
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
SK4&nbsp;&nbsp;&nbsp; SLA&nbsp;&nbsp;&nbsp; R3,11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; make room for page offset
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SRL&nbsp;&nbsp;&nbsp; R1,1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; offset must be even
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; R1,R3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; add page offset to chip address
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SLA&nbsp;&nbsp;&nbsp; R1,1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; restore R1
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SRC&nbsp;&nbsp;&nbsp; R0,13&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; restore R0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; B&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *R11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; done</tt></pre>
</td>
</tr>
</table>

<p>N.B. The routines use the following formulas, where P0-P15 are the 15
bits of the page number (P0-P3 ignored), and A0-A15 are the address bus
lines (A0-A3 ignored, select mapper's register).
<br>Chip pair (from left to right, from bottom to top): P4 ~P5 P12 P14.
<br>Chip row: A15. Top row is even byte (A15 low), bottom row is odd byte
(A15 high).
<br>Address in chip: P6-P11 P13 P15 A4-A14.
<br>&nbsp;
<table BORDER COLS=24 WIDTH="53%" >
<tr>
<td COLSPAN="2">
<center>Layer</center>
</td>

<td COLSPAN="2">Chip #</td>

<td COLSPAN="19">
<center>Address in chip (>00000-7FFFF)</center>
</td>

<td>Byte</td>
</tr>

<tr>
<td>P4</td>

<td>~P5</td>

<td>P12</td>

<td>P14</td>

<td>P6</td>

<td>P7</td>

<td>P8</td>

<td>P9</td>

<td>P10</td>

<td>P11</td>

<td>P13</td>

<td>P15</td>

<td>A4</td>

<td>A5</td>

<td>A6</td>

<td>A7</td>

<td>A8</td>

<td>A9</td>

<td>A10</td>

<td>A11</td>

<td>A12</td>

<td>A13</td>

<td>A14</td>

<td>A15</td>
</tr>

<tr>
<td COLSPAN="12">
<center>Page number</center>
</td>

<td COLSPAN="12">
<center>Offset in page</center>
</td>
</tr>
</table>

<h4>
<a NAME="programming EEPROMs"></a>Programming an EEPROM</h4>
There are various types of EEPROMs. All have in common the fact that they
come full of >FF bytes (binary 1111 1111 1111 1111) and that you can only
turn '1' bits into '0'. Once this is done, the only way to go back is to
erase the whole chip, or a block in the chip (the size of a block varies
from chip to chip). Such chips are called "Flash" EEPROMs because block
erasure is much more rapid than erasing one word at a time (stil it may
takes several seconds to erase the whole chip).
<p>There are two main types of Flash on the market:
<ul>
<li>
Registered EEPROMs, like the 29F040 let you write one word at a time.</li>

<li>
Sectored EEPROMs, like the 29C040 require that you always write a sector
at a time, which generally means 256 bytes.</li>
</ul>
It's entirely up to you to decide which type you prefer, and you may even
have both types on board, as long as you don't mix chips within a given
pair (e.g. U100 and U104).
<p>In order to write to a chip, or to erase it, you must pass it an intricate
validation code. This is meant to prevent spurious writing operations from
ruining the contents of the memory. Unfortunately, the validation code
may vary from chip to chip, or from manufacturer to manufacturer. Practically,
this means that you can't write an universal programming algorithm; your
routines must be tailored to the type of chip installed. Flash-EEPROMs
generally have a "read chip ID" command, but again the syntax of that command
varies from chip to chip and between manufacturers...
<p><b>Programming a 29F040</b>
<p>These examples are for STmicroelectronics version of the 29F040. The
version produced by AMD uses the same scheme, except that the key addresses
are >555 and >2AA (actually, any address ending with these numbers will
do).
<p><u>To write a byte into the chip:</u>
<br>Write >AA at address >5555
<br>Write >55 at address >2AAA
<br>Write >A0 at address >5555
<br>Write the desired byte at the desired address.
<p>You may check whether writing is completed by reading back the byte.
The most significant bit (weight >80) will be inverted until programming
is finished. Also, the next bit (weight >40) will toggle its value each
time you read it. When programming is finished, it takes the assigned value.
The next bit (weight >20) should be '0' during propgramming, if it becomes
'1' an error occured (e.g. you tried to turn a '0' into a '1'). You must
write >F0 to any address to clear the error condition.
<p><u>To erase a block (64 Kbytes) or the whole chip:</u>
<br>Write >AA at address >5555
<br>Write >55 at address >2AAA
<br>Write >80 at address >5555
<br>Write >AA at address >5555
<br>Write >55 at address >2AAA
<br>Write >10 at address >5555 to erase the whole chip.
<br>Or write >30 at an address in the desired block (i.e. >x0000).
<p>You may erase more than one block by writing >30 to another block. But
you must hurry and do this within 80 microseconds of the previous write.
Given that the average assembly instruction takes about 10 microseconds
on the TI-99/4A, it won't be that easy... To get an idea, read a byte at
any address: if bit >08 is set it's too late to send another block number.
Note that 64K blocks are >10000 apart in chip memory, which means that
you must alter bits 6 to 8 of the page number to alter them (bits >x38xxx).
In other words, add >008000 to the page number to move to the next block.
<p>You may check whether writing is completed by reading back the byte.
The most significant bit (weight >80) will be '0' until erasing is finished
and '1' thereafter. Also, the next bit (weight >40) will toggle its value
each time you read it. When programming is finished, it stays as '1'. If
the next bit (weight >20) becomes '1', an error occured. This is bad news
because it generally means that the block is bad...You must write >F0 to
any address to reset the chip.
<p>You may suspend erasure, so that you can read data from another block
(you can't read data from the block being erased).
<br>To suspend erasure, write >B0 to any address.
<br>To resume erasure, write >30 to any address.
<br>To abort erasure, write >F0 to any address. Be aware that this is likely
to result in invalid data in the block being erased.
<p>With the AMD chip, if you attempt to read from the block being erased
you will notice that bit >02 toggles, just like bit >40 (but it does not
toggle during a write). When erasing is suspended, bit >40 stops toggling,
but bit >02 continues. This feature is not provided by the STmicro chip.
<p><u>To read the chip ID:</u>
<br>Write >AA at address >5555
<br>Write >55 at address >2AAA
<br>Write >90 at address >5555
<br>Read manufacturer ID from address >00000: >20 for STmicro, >01 for
AMD.
<br>Read chip ID from address >00001: >E2 with STmicro, >A4 with AMD.
<br>Read block protection status from >x0002: >00 for unlocked, >01 for
protected.
<br>Write >F0 to any address to return to read mode.
<p>Note that protecting and unprotecting blocks can only be done by applying
+12 volts to several of the chip's pins. The HAMS board makes no provisions
for this, so you don't need to worry about block protection.
<p><u>To reset the chip:</u>
<br>Write >F0 to any address.
<p>This returns the chip to standard "read" mode. It can also be done to
abort a command sequence, e.g. if you change your mind after entering the
validation code. You must use this command to clear an error condition
and to exit "chip ID" mode.
<p>The following (untested) routine illustrates how to write a word to
a pair of 29F040 by STmicro (AMD chips are easier since the validation
code is written inside a single page).
<br>&nbsp;
<table CELLSPACING=2 CELLPADDING=2 BGCOLOR="#E6E6E6" >
<caption><tbody>
<br></tbody></caption>

<tr>
<td>
<pre><tt>*--------------------------------------
* This routine writes a word into a pair of ST 29F040 chips
* R0 = page number
* R1 = offset in page
* R2 = word to write
* R12 = CRU address of the card
*--------------------------------------
WR29F&nbsp; MOV&nbsp;&nbsp; R11,R10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; save return point
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MOV&nbsp;&nbsp; R0,R5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; save for later
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MOV&nbsp;&nbsp; R1,R6
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MOV&nbsp;&nbsp; R2,R7
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BL&nbsp;&nbsp;&nbsp; @PG2AD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get chip # + address
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ANDI&nbsp; R2,>FF00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; keep only chip #

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SBO&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; access card in DSR space
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SBO&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set mapping mode
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SBO&nbsp;&nbsp; 7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; disable reading at >4000-5FFF

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LI&nbsp;&nbsp;&nbsp; R3,>5555&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; new address
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BL&nbsp;&nbsp;&nbsp; @AD2PG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get page + offset
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MOV&nbsp;&nbsp; R0,@>5FE8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set page at >4000
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MOV&nbsp;&nbsp; @HAAAA,@>4000(R1)&nbsp;&nbsp;&nbsp;&nbsp; write >AA to both chips

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LI&nbsp;&nbsp;&nbsp; R3,>2AAA&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; new address
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BL&nbsp;&nbsp;&nbsp; @AD2PG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get page + offset
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MOV&nbsp;&nbsp; R0,@>5FE8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set page at >4000
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MOV&nbsp;&nbsp; @H5555,@>4000(R1)&nbsp;&nbsp;&nbsp;&nbsp; write >55 to both chips

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LI&nbsp;&nbsp;&nbsp; R3,>5555&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; new address
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BL&nbsp;&nbsp;&nbsp; @AD2PG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get page + offset
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MOV&nbsp;&nbsp; R0,@>5FE8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set page at >4000
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MOV&nbsp;&nbsp; @HA0A0,@>4000(R1)&nbsp;&nbsp;&nbsp;&nbsp; write >AA to both chips&nbsp;

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MOV&nbsp;&nbsp; R5,@>5FE8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set saved page # at >4000
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MOV&nbsp;&nbsp; R7,@>4000(R6)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; write saved value to saved offset&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SBZ&nbsp;&nbsp; 7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; enable reading again (optional: wait till done)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SBZ&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; turn DSR space off
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; B&nbsp;&nbsp;&nbsp;&nbsp; *R10
*
H5555 DATA&nbsp;&nbsp; >5555&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; validation code
HAAAA DATA&nbsp;&nbsp; >AAAA
HA0A0 DATA&nbsp;&nbsp; >A0A0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; code for "write byte"</tt></pre>
</td>
</tr>

<tr>
<td></td>
</tr>
</table>

<p><b>Programming a 29C040</b>
<p>This chip always programs 256 bytes at a time, starting on an address
that is a multiple of 256 (i.e. >00000, >00100, >00200, etc). You must
thus write all 256 bytes (in any order), never allowing for more than 150
microseconds between bytes. Once you stop writing for longer than this,
programming begins. Any byte that you didn't set will have a value of >FF.
<p>Note that there is no block erase, as programming automatically erases
a sector before rewriting it. There is a chip erase command, however.
<p>In addition, you can set a global protection command, which will cause
the device to demand a validation code before programming a sector. You
set the protection by sending a validation code prior to programming a
sector (you must program a sector for the command to be accepted).
<p><u>To enter write-protect mode:</u>
<br>Write >AA at address >5555
<br>Write >55 at address >2AAA
<br>Write >A0 at address >5555
<br>Now write a 256-byte sector.
<p>You may want to read back the last byte to find out when programming
is finished. The most significant bit (weight >80) will be inverted while
programming is proceeding. Also, the next bit (weight >40) will toggle
every time you read it. Once programming is finished, both bits will match
the value you entered (hopefully).
<p>From now on, you will need to enter the validation code before you can
program any sector (which means that you will remain in write-protect mode).
The protection status remains active even after a power-down.
<p><u>To exit write-protect mode:</u>
<br>Write >AA at address >5555
<br>Write >55 at address >2AAA
<br>Write >80 at address >5555
<br>Write >AA at address >5555
<br>Write >55 at address >2AAA
<br>Write >20 at address >5555
<br>Now write a 256-byte sector.
<p>Here also, you can read the last byte to figure out when programming
is finished (see above).
<p>From now on you can write sectors directly, without having to enter
a validation code. This is mostly useful when implementing a Flash disk.
To implement ROMs, I recommend that you use the write-protected mode.
<p><u>To erase the whole chip:</u>
<br>Write >AA at address >5555
<br>Write >55 at address >2AAA
<br>Write >80 at address >5555
<br>Write >AA at address >5555
<br>Write >55 at address >2AAA
<br>Write >10 at address >5555
<p>Erasing is fast, compared with a 29F040: only 20 milliseconds.
<p><u>To read the chip ID:</u>
<br>Write >AA at address >5555
<br>Write >55 at address >2AAA
<br>Write >90 at address >5555
<br>Read manufacturer ID from address >00000: >1F for Atmel
<br>Read chip ID from address >00001: >5B for 29C040, >A4 for 29C040A
<br>Read lower boot block protection status from >00002: >FE unlocked,
>FF locked.
<br>Read upper boot block protection status from >7FFF2: >FE unlocked,
>FF locked.
<br>Write >AA at address >5555
<br>Write >55 at address >2AAA
<br>Write >F0 at address >5555 to return to normal reading mode. (Or just
power down).
<p><u>Locking up boot blocks:</u>
<br>The device allows you to irreversibly lock the first 16 Kbytes and/or
the last 16 Kbytes in the chip. This is meant to implement boot sectors
on Flash disks. I must stress that the operation cannot be undone: once
a block is locked you cannot change its contents. Ever! Also note that
the "chip erase" command is disabled once a boot block has been locked.
<p>Make sure you really want to do this!
<br>Write >AA at address >5555
<br>Write >55 at address >2AAA
<br>Write >80 at address >5555
<br>Write >AA at address >5555
<br>Write >55 at address >2AAA
<br>Write >40 at address >5555
<br>To lock the first 64 sectors (>00000-03FFF) write >00 at >00000.
<br>To lock the last 64 sectors (>7C000-7FFFF) write >FF at >7FFFF.
<br>&nbsp;
<p>The following (untested) routine illustrates how to write a 256-words
sector to a pair of 29C040:
<br>&nbsp;
<table CELLSPACING=2 CELLPADDING=2 BGCOLOR="#E6E6E6" >
<caption><tbody>
<br></tbody></caption>

<tr>
<td>
<pre><tt>*--------------------------------------
* This routine writes 512 bytes into a pair of Atmel 29C040 chips
* It sets/leaves the chips in write-protect mode
* R0 = page number
* R1 = offset in page
* R2 = address of data to write
* R12 = CRU address of the card
*--------------------------------------
WR29F&nbsp; MOV&nbsp;&nbsp; R11,R10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; save return point
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MOV&nbsp;&nbsp; R0,R5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; save for later
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MOV&nbsp;&nbsp; R1,R6
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MOV&nbsp;&nbsp; R2,R7
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BL&nbsp;&nbsp;&nbsp; @PG2AD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get chip # + address
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ANDI&nbsp; R2,>FF00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; keep only chip #

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SBO&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; access card in DSR space
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SBO&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set mapping mode
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SBO&nbsp;&nbsp; 7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; disable reading at >4000-5FFF

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LI&nbsp;&nbsp;&nbsp; R3,>5555&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; new address
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BL&nbsp;&nbsp;&nbsp; @AD2PG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get page + offset
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MOV&nbsp;&nbsp; R0,@>5FE8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set page at >4000
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MOV&nbsp;&nbsp; @HAAAA,@>4000(R1)&nbsp;&nbsp;&nbsp;&nbsp; write >AA to both chips

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LI&nbsp;&nbsp;&nbsp; R3,>2AAA&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; new address
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BL&nbsp;&nbsp;&nbsp; @AD2PG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get page + offset
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MOV&nbsp;&nbsp; R0,@>5FE8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set page at >4000
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MOV&nbsp;&nbsp; @H5555,@>4000(R1)&nbsp;&nbsp;&nbsp;&nbsp; write >55 to both chips

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LI&nbsp;&nbsp;&nbsp; R3,>5555&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; new address
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BL&nbsp;&nbsp;&nbsp; @AD2PG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get page + offset
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MOV&nbsp;&nbsp; R0,@>5FE8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set page at >4000
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MOV&nbsp;&nbsp; @HA0A0,@>4000(R1)&nbsp;&nbsp;&nbsp;&nbsp; write >AA to both chips&nbsp;

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MOV&nbsp;&nbsp; R5,@>5FE8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set saved page at >4000
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AI&nbsp;&nbsp;&nbsp; R6,>4000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; turn offset into address
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LI&nbsp;&nbsp;&nbsp; R5,>0100&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sector size (2 x 256 bytes)
LP1&nbsp;&nbsp;&nbsp; MOV&nbsp;&nbsp; *R2+,*R6+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; copy loop
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DEC&nbsp;&nbsp; R5&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JGT&nbsp;&nbsp; LP1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; less than 50 microseconds/byte&nbsp;

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SBZ&nbsp;&nbsp; 7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; enable reading again (optional: wait till done)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SBZ&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; turn DSR space off
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; B&nbsp;&nbsp;&nbsp;&nbsp; *R10
*
H5555 DATA&nbsp;&nbsp; >5555&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; validation code
HAAAA DATA&nbsp;&nbsp; >AAAA
HA0A0 DATA&nbsp;&nbsp; >A0A0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; code for "write sector"</tt></pre>
</td>
</tr>

<tr>
<td></td>
</tr>
</table>

<h4>
<a NAME="transparent mode"></a>Transparent mode</h4>
When the mapper is in transparent mode, the pages appearing in memory are
independent of the contents of the registers. Rather, they depend on the
address where the memory is supposed to appear. The cartoon below indicates
in which chip (and at which chip address) the various area of the TI-99/4A
address space are mapped in transparent mode. Remember that chips go by
pair, with the even byte in the top row and the odd byte in the bottom
row. In normal mode, chips in the second layer will be used, but in SAMS-compatible
mode (CRU bit 3 = '1') everything comes from the first layer.
<pre>&nbsp; U100&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; U101&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; U102&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; U103&nbsp;&nbsp;&nbsp;&nbsp; address
+-------+ +-------+ +-------+ +-------+&nbsp; in chip
| >0000 | | >2000 | | >8000 | | >A000 |&nbsp; >00000
|&nbsp;&nbsp; to&nbsp; | |&nbsp;&nbsp; to&nbsp; | |&nbsp;&nbsp; to&nbsp; | |&nbsp;&nbsp; to&nbsp; |&nbsp;
| >1FFE | | >3FFE | | >9FFE | | >BFFE |&nbsp;
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;
| >4000 | | >6000 | | >C000 | | >E000 |&nbsp; >01000
|&nbsp;&nbsp; to&nbsp; | |&nbsp;&nbsp; to&nbsp; | |&nbsp;&nbsp; to&nbsp; | |&nbsp;&nbsp; to&nbsp; |&nbsp;
| >5FFE | | >7FFE | | >DFFE | | >FFFE |&nbsp;
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp; >02000
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;
+-------+ +-------+ +-------+ +-------+&nbsp;

&nbsp; U104&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; U105&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; U106&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; U107
+-------+ +-------+ +-------+ +-------+&nbsp;
| >0001 | | >2001 | | >8001 | | >A001 |&nbsp; >00000&nbsp;
|&nbsp;&nbsp; to&nbsp; | |&nbsp;&nbsp; to&nbsp; | |&nbsp;&nbsp; to&nbsp; | |&nbsp;&nbsp; to&nbsp; |&nbsp;
| >1FFF | | >3FFF | | >9FFF | | >BFFF |&nbsp;
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;
| >4001 | | >6001 | | >C001 | | >E001 |&nbsp; >01000&nbsp;
|&nbsp;&nbsp; to&nbsp; | |&nbsp;&nbsp; to&nbsp; | |&nbsp;&nbsp; to&nbsp; | |&nbsp;&nbsp; to&nbsp; |&nbsp;
| >5FFF | | >7FFF | | >DFFF | | >FFFF |&nbsp;
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp; >02000
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;
+-------+ +-------+ +-------+ +-------+</pre>
As you can see, by installing EEPROMs in U100+U104 you can have permanent
memory for both the console ROM space (>0000-1FFF) and the DSR space (>4000-5FFF)
and RAM in the rest of the addressing space, which was the whole point
of this intricate chip mapping in the first place.
<br>&nbsp;
<h3>
<a NAME="CRU map"></a>CRU map</h3>
&nbsp;
<table BORDER >
<tr>
<td><b>Bit</b></td>

<td><b>Address</b></td>

<td><b>Effect</b></td>
</tr>

<tr>
<td>0</td>

<td>>1x00</td>

<td>0: Disable access to the DSR area at >4000-5FFF
<br>1: Enable access to the DSR area at >4000-5FFF</td>
</tr>

<tr>
<td>1</td>

<td>>1x02</td>

<td>0: Mapper in transparent mode
<br>1: Mapper in mapping mode</td>
</tr>

<tr>
<td>2</td>

<td>>1x04</td>

<td>0: Enable mapping at >0000-1FFF
<br>1: Disable mapping at >0000-1FFF</td>
</tr>

<tr>
<td>3</td>

<td>>1x06</td>

<td>0: HAMS standard mode
<br>1: SAMS-compatible mode.</td>
</tr>

<tr>
<td>4</td>

<td>>1x08</td>

<td>0: Map memory at >4000-5FE0, registers at >5FE0-5FFF&nbsp;
<br>1: Access mapper's registers repeatedly in >4000-5FFF</td>
</tr>

<tr>
<td>5</td>

<td>>1x0A</td>

<td>0: Disable mapping at >6000-7FFF&nbsp;
<br>1: Enable mapping at >6000-7FFF</td>
</tr>

<tr>
<td>6</td>

<td>>1x0C</td>

<td>0: Enable mapping to >8000-83FF
<br>1: Disable mapping to >8000-83FF</td>
</tr>

<tr>
<td>7</td>

<td>>1x0E</td>

<td>0: Enable reading from >4000-5FFF
<br>1: Disable reading from >4000-5FFF</td>
</tr>
</table>

<p>All CRU bits are reset to '0' upon power-up or console hardware reset
(e.g. plugging in a new cartridge), but not by soft resets (e.g. pressing
the QUIT key). CRU bits can only be written to, not read back. If you wish,
you can have your software save the current settings in a given memory
page.
<p><b>Bit 0</b> enables access to the DSR area, at >4000-5FFF. What appears
in this area depends on bit 4 and bit 7.
<p><b>Bit 1</b> controls mapping mode, just like it does on the SAMS card.
In transparent mode, the mappers registers are not used. Instead, the page
number is directly determined by the most significant digit of the address:
>0000 selects page >000, >1000 selects page >001, etc. Since CRU bits are
'0' upon power-up, this mode is active by default. This allows you to program
meaningful page numbers into the various registers before switching to
mapping mode.
<p><b>Bit 2</b> enables mapping in the console ROM area, at >0000-1FFF.
This requires a small modification of the TI-99/4A console: the installation
of a switch allowing to disable the console ROMs. Since all CRU bits are
reset upon power-up, mapping in this area is on by default. This is necessary,
so that you can implement your own boot code. However, if you chose not
to use this feature, you can disable it by opening DIP-switch #2 (labelled
ROM on the board).
<p><b>Bit 3</b>, when set to '1', enters SAMS-compatible mode. In this
mode, the most significant digit of the page number is not considered.
As a result, all pages map to layer 1, which should consist only of RAM
for compatibility with the SAMS board. For full SAMS compatibility, you
should also set CRU bit 4 to '1'.
<p><b>Bit 4</b> decides whether the area >4000-5FFF will display memory
or the mapper's registers. By default it displays memory, which allows
for the implementation of DSRs and for programming EEPROM pages. Registers
only appear in the last 32 bytes, at >5FE0-5FFF. Setting bit 4 to '1' allows
to access the mappers registers within the whole area >4000-5FFF, which
is what the SAMS board does. Note that the most significant digit of the
page number can be written, but cannot be read back. Thus, your software
should save somewhere in memory a copy of the mappers's 16 registers.
<p><b>Bit 5</b>, when set to '1' enables mapping to the cartridge space,
at >6000-7FFF. This memory area is also used by RAMBO devices, such as
the Horizon ramdisk or my IDE card. Note that this bit is invertedso mapping
in this area is off upon power-up (contrarily to bits 2 and 6).
<p><b>Bit 6</b> controls mapping in the "scratch-pad" area, at >8000-83FF.
Normally, the console SRAM chip answers in this area. Since the console
only has >100 bytes RAM, it maps them 4 times at >8000, >8100, >8200, and
>8300. Setting bit 6 to '0' causes the HAMS board to answer in this area.
It does not, however, repeat the same >100 bytes 4 times like the console
does. Rather, it implements the full range of >400 bytes. Be aware that
this may confuse some poorly written software. Most softwares use the >8300
address, but if one were to write a value at >8300 and expect to read it
back at >8200, it would not work. This feature also requires the installation
of a switch in the console. Since bit 6 is '0' at power-up time, this feature
is on by default, but can be disabled by opening DIP-switch #1.
<p><b>Bit 7</b> allows for programming of EEPROMs. In most cases, programming
requires passing a command and a validation code to the EEPROM. Unfortunatley
the TI-99/4A is in the habit of reading a word before writing it (at least
this is the case with most instructions). This may result in scrambling
the validation sequence and prevent writing to the EEPROM. By setting bit
7 to '1', reading is disabled in the >4000-5FFF area, while still allowing
you to write to an EEPROM page that has been set to appear there. Because
each word maps to two chips (one for the even byte, one for the odd byte)
there will not be any issue related to the fact the the TI-99/4A always
writes two bytes at a time.
<p>Note that mapping in the memory expansion area (>2000-3FFF and >A000-FFFF)
cannot be disabled by software. You can disable it by opening DIP-switch
#3, in case you'd like to use the special features of the HAMS board together
with another memory expansion board.
<p>As you can see, the board has the ability to map in the whole addressing
range of the TI-99/4a, not just the memory expansion space. This allows
you to map memory in the cartridge space (>6000-7FFF), to install DSRs
in the card (at >4000-5FFF), to override the console ROMs (at >0000-1FFF)
and the console "scratch-pad" RAM (at >8000-83FF). The latter two require
the installation of switches inside the console.
<p>Mapping is controlled by CRU bits, as well as with DIP-switches. The
DIP-switches control the default mapping, i.e. what happens upon power-up
when all CRU bits are reset. An open switch disables mapping, a closed
switch enables it, under control of the CRU.
<ul>
<li>
DIP switch #1 control mapping in the scratch-pad area, >8000-83FF. Note
that the console only contains 256 bytes of RAM, and thus maps >8100, >8200
and >8300 onto >8000. The HAMS board does not do this, and maps the whole
1024 bytes independently, which may or may not cause software problems...</li>

<li>
DIP switch #2 controls mapping in the console ROM area, >0000-1FFF.</li>

<li>
DIP switch #3 controls mapping in the memory expansion area, >2000-3FFF
and >A000-FFFF. This may be useful if you want to use the HAMS board toghether
with another memory expansion board.</li>

<li>
The other DIP switches allow you to set the CRU address of the board. More
precisely, they encode the second digit of the CRU address: >1x00. An open
switch selects a digit (8, 4, 2, or 1 for switches #4 to 8, respectively),
a closed switch skips it. To compose a CRU address, just add up the open
switches: e.g. closed-open-closed-open encodes CRU address >1500 (because
5 is 4+1).</li>
</ul>
The table below summarizes how to control mapping in the various memory
areas:
<br>&nbsp;
<table BORDER >
<tr>
<td><b>Address</b></td>

<td><b>CRU&nbsp;</b></td>

<td><b>Dip switch</b></td>
</tr>

<tr>
<td>>0000-1FFF</td>

<td>Bit 2 = 0</td>

<td>2</td>
</tr>

<tr>
<td>>2000-3FFF</td>

<td>&nbsp; -</td>

<td>3</td>
</tr>

<tr>
<td>>4000-5FE0</td>

<td>Bit 4 = 0</td>

<td>-</td>
</tr>

<tr>
<td>>6000-7FFF</td>

<td>Bit 5 = 1</td>

<td>-</td>
</tr>

<tr>
<td>>8000-83FF</td>

<td>Bit 6 = 0</td>

<td>1</td>
</tr>

<tr>
<td>>8400-9FFF</td>

<td>N/A</td>

<td>N/A</td>
</tr>

<tr>
<td>>A000-FFFF</td>

<td>&nbsp; -</td>

<td>3</td>
</tr>
</table>

<br>&nbsp;
<address>
Revision 1. 14/3/08. Preliminary. Board not build, not tested.</address>

<center>
<p><br><a href="titechpages.htm">Back to the TI-99/4A Tech Pages</a></center>

<p><br>
</body>
</html>
